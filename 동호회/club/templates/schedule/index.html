{% extends 'base.html' %}

{% block title %}일정{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3><i class="bi bi-calendar-event"></i> 일정</h3>
    {% if current_user.is_staff() %}
    <a href="{{ url_for('schedule.create') }}" class="btn btn-primary">
        <i class="bi bi-plus-lg"></i> 일정 등록
    </a>
    {% endif %}
</div>

<!-- 월 선택 -->
<div class="card mb-4">
    <div class="card-body">
        <form method="GET" class="row g-3 align-items-end">
            <div class="col-auto">
                <label class="form-label">년도</label>
                <select name="year" class="form-select">
                    {% for y in range(2024, 2028) %}
                    <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}년</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-auto">
                <label class="form-label">월</label>
                <select name="month" class="form-select">
                    {% for m in range(1, 13) %}
                    <option value="{{ m }}" {% if m == month %}selected{% endif %}>{{ m }}월</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary">조회</button>
            </div>
        </form>
    </div>
</div>

<h4 class="mb-3">{{ year }}년 {{ month }}월</h4>

{% if schedules %}
<div class="list-group">
    {% for schedule in schedules %}
    <a href="{{ url_for('schedule.view', schedule_id=schedule.id) }}" class="list-group-item list-group-item-action">
        <div class="d-flex w-100 justify-content-between align-items-center">
            <div>
                <div class="d-flex align-items-center gap-2">
                    <span class="badge bg-primary">{{ schedule.event_date.strftime('%m/%d') }}</span>
                    <h5 class="mb-0">{{ schedule.title }}</h5>
                </div>
                {% if schedule.location %}
                <small class="text-muted"><i class="bi bi-geo-alt"></i> {{ schedule.location }}</small>
                {% endif %}
                {% if schedule.start_time %}
                <small class="text-muted ms-2"><i class="bi bi-clock"></i> {{ schedule.start_time }}{% if schedule.end_time %} ~ {{ schedule.end_time }}{% endif %}</small>
                {% endif %}
            </div>
            <div>
                {% set attending = schedule.attendances.filter_by(status='attending').count() %}
                <span class="badge bg-success">참석 {{ attending }}명</span>
            </div>
        </div>
    </a>
    {% endfor %}
</div>
{% else %}
<div class="text-center text-muted py-5">
    <i class="bi bi-calendar-x" style="font-size: 4rem;"></i>
    <p class="mt-3">등록된 일정이 없습니다.</p>
</div>
{% endif %}
{% endblock %}
