<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>배드민턴 대진표 생성기 (간편 입력)</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><ellipse cx='50' cy='75' rx='18' ry='18' fill='%23fff' stroke='%23333' stroke-width='2'/><path d='M32 20 L50 75 L68 20 Q50 35 32 20Z' fill='%23fff' stroke='%23333' stroke-width='2'/><line x1='38' y1='30' x2='62' y2='30' stroke='%23333' stroke-width='1.5'/><line x1='35' y1='40' x2='65' y2='40' stroke='%23333' stroke-width='1.5'/><line x1='34' y1='50' x2='66' y2='50' stroke='%23333' stroke-width='1.5'/><line x1='36' y1='60' x2='64' y2='60' stroke='%23333' stroke-width='1.5'/></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 30px 0; }
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00d2ff, #3a7bd5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .input-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid rgba(255,255,255,0.1);
        }
        .input-section h2 {
            color: #00d2ff;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-align: center;
        }
        .input-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .input-group label {
            color: #00d2ff;
            font-size: 1.1em;
            min-width: 80px;
        }
        .input-group input {
            padding: 10px 15px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 1em;
            text-align: center;
        }
        .input-group input[type="number"] { width: 80px; }
        
        /* 등급별 인원 입력 */
        .grade-section {
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .grade-section h3 {
            color: #f39c12;
            margin-bottom: 15px;
            text-align: center;
        }
        .grade-inputs {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .grade-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.05);
            padding: 10px 15px;
            border-radius: 8px;
        }
        .grade-item label {
            font-weight: bold;
            color: #f39c12;
            font-size: 1.1em;
        }
        .grade-item input {
            width: 60px;
            padding: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            text-align: center;
        }
        
        /* 미리보기 */
        .preview-section {
            background: rgba(0,210,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(0,210,255,0.3);
        }
        .preview-section h3 {
            color: #00d2ff;
            margin-bottom: 15px;
            text-align: center;
        }
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        .preview-team {
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            padding: 15px;
        }
        .preview-team.blue { border: 2px solid #3498db; }
        .preview-team.white { border: 2px solid #ecf0f1; }
        .preview-team h4 {
            text-align: center;
            margin-bottom: 10px;
        }
        .preview-team h4.blue { color: #3498db; }
        .preview-team h4.white { color: #ecf0f1; }
        .preview-content {
            font-size: 0.9em;
            color: #aaa;
            text-align: center;
        }
        .preview-summary {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
        }
        .preview-summary span { color: #00d2ff; font-weight: bold; }
        
        .btn-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }
        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            color: #fff;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
        }
        .btn-generate { background: linear-gradient(45deg, #00d2ff, #3a7bd5); }
        .btn-regenerate { background: linear-gradient(45deg, #f39c12, #e74c3c); }
        .btn:hover { transform: scale(1.05); }
        
        /* 결과 섹션 */
        .result-section { display: none; }
        .result-section.active { display: block; }
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value { font-size: 2em; font-weight: bold; color: #00d2ff; }
        .stat-label { font-size: 0.9em; color: #aaa; }
        
        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
        }
        .tab-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }
        .tab-btn:hover { background: rgba(255,255,255,0.2); }
        .tab-btn.active { background: linear-gradient(45deg, #00d2ff, #3a7bd5); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* 코트 뷰 */
        .courts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        .court {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255,255,255,0.1);
        }
        .court-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .court-name { font-size: 1.3em; font-weight: bold; color: #00d2ff; }
        .court-count {
            background: rgba(0,210,255,0.2);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9em;
        }
        .match {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 12px;
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .match-order {
            width: 30px;
            height: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }
        .match-type {
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .match-type.MD { background: #3498db; }
        .match-type.WD { background: #e74c3c; }
        .match-type.XD { background: #9b59b6; }
        .match-teams { flex: 1; display: flex; align-items: center; gap: 10px; }
        .team { padding: 5px 12px; border-radius: 5px; font-size: 0.9em; }
        .team.blue { background: rgba(52, 152, 219, 0.3); border: 1px solid #3498db; }
        .team.white { background: rgba(236, 240, 241, 0.3); border: 1px solid #ecf0f1; }
        .vs { color: #f39c12; font-weight: bold; }
        
        /* 선수 뷰 */
        .players-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
        }
        .team-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
        }
        .team-section.blue-team { border: 2px solid #3498db; }
        .team-section.white-team { border: 2px solid #ecf0f1; }
        .grade-group { margin: 15px 0; }
        .grade-label { font-size: 1.1em; font-weight: bold; margin-bottom: 10px; color: #f39c12; }
        .player-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .player-chip {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
        }
        .player-chip.male { background: rgba(52, 152, 219, 0.3); border: 1px solid #3498db; }
        .player-chip.female { background: rgba(231, 76, 60, 0.3); border: 1px solid #e74c3c; }
        .player-chip:hover { transform: scale(1.05); }
        .player-games { font-size: 0.8em; opacity: 0.7; margin-left: 5px; }
        
        /* 통계 뷰 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .stats-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
        }
        .stats-card h3 { color: #00d2ff; margin-bottom: 15px; }
        .stats-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        /* 모달 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: #1a1a2e;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid rgba(255,255,255,0.1);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-title { font-size: 1.5em; color: #00d2ff; }
        .modal-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5em;
            cursor: pointer;
        }
        .player-match {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        /* 도움말 버튼 */
        .help-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #00d2ff, #3a7bd5);
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 210, 255, 0.4);
            z-index: 100;
            transition: all 0.3s;
        }
        .help-btn:hover { transform: scale(1.1); }
        
        @media (max-width: 768px) {
            .preview-grid { grid-template-columns: 1fr; }
            .players-grid { grid-template-columns: 1fr; }
            .courts-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>배드민턴 대진표 생성기</h1>
            <p>인원과 비율만 입력하면 자동으로 선수를 생성하고 대진표를 만듭니다</p>
        </header>
        
        <!-- 입력 섹션 -->
        <div class="input-section">
            <h2>간편 입력</h2>
            
            <div class="input-row">
                <div class="input-group">
                    <label>코트 수:</label>
                    <input type="number" id="numCourts" value="6" min="1" max="20">
                </div>
                <div class="input-group">
                    <label>남자 비율:</label>
                    <input type="number" id="maleRatio" value="70" min="30" max="90">
                    <span>%</span>
                </div>
            </div>
            
            <div class="grade-section">
                <h3>등급별 인원 수</h3>
                <div class="grade-inputs">
                    <div class="grade-item">
                        <label>A급:</label>
                        <input type="number" id="gradeA" value="10" min="0">
                    </div>
                    <div class="grade-item">
                        <label>B급:</label>
                        <input type="number" id="gradeB" value="15" min="0">
                    </div>
                    <div class="grade-item">
                        <label>C급:</label>
                        <input type="number" id="gradeC" value="20" min="0">
                    </div>
                    <div class="grade-item">
                        <label>D급:</label>
                        <input type="number" id="gradeD" value="13" min="0">
                    </div>
                    <div class="grade-item">
                        <label>E급:</label>
                        <input type="number" id="gradeE" value="7" min="0">
                    </div>
                </div>
            </div>
            
            <!-- 미리보기 -->
            <div class="preview-section">
                <h3>선수 배분 미리보기</h3>
                <div class="preview-grid">
                    <div class="preview-team blue">
                        <h4 class="blue">청팀 (소문자)</h4>
                        <div class="preview-content" id="bluePreview">a1남, a1여, b1남, b1여 ...</div>
                    </div>
                    <div class="preview-team white">
                        <h4 class="white">백팀 (대문자)</h4>
                        <div class="preview-content" id="whitePreview">A1남, A1여, B1남, B1여 ...</div>
                    </div>
                </div>
                <div class="preview-summary">
                    총 <span id="totalCount">65</span>명 
                    (청팀: <span id="blueCount">32</span>명, 백팀: <span id="whiteCount">33</span>명)
                    / 남자: <span id="maleCount">45</span>명, 여자: <span id="femaleCount">20</span>명
                </div>
            </div>
            
            <div class="btn-row">
                <button class="btn btn-generate" onclick="generateSchedule()">대진표 생성</button>
            </div>
        </div>
        
        <!-- 결과 섹션 -->
        <div class="result-section" id="resultSection">
            <div class="stats-bar" id="statsBar"></div>
            
            <div class="tabs">
                <button class="tab-btn active" data-tab="courts">라운드별 대진표</button>
                <button class="tab-btn" data-tab="players">선수 목록</button>
                <button class="tab-btn" data-tab="stats">통계</button>
            </div>
            
            <div id="courts" class="tab-content active">
                <div class="courts-container" id="courtsContainer"></div>
            </div>
            
            <div id="players" class="tab-content">
                <div class="players-grid" id="playersGrid"></div>
            </div>
            
            <div id="stats" class="tab-content">
                <div class="stats-grid" id="statsGrid"></div>
                <div class="btn-row">
                    <button class="btn btn-regenerate" onclick="regenerateSchedule()">대진표 재생성</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 선수 상세 모달 -->
    <div class="modal" id="playerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">선수명</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>
    
    <!-- 도움말 버튼 -->
    <button class="help-btn" onclick="showHelp()">?</button>
    
    <!-- 도움말 모달 -->
    <div class="modal" id="helpModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">사용 설명서</h2>
                <button class="modal-close" onclick="closeHelp()">&times;</button>
            </div>
            <div style="line-height: 1.8; color: #ccc;">
                <h3 style="color: #f39c12; margin: 20px 0 10px;">선수 이름 규칙</h3>
                <p><strong style="color: #3498db;">청팀:</strong> 소문자 등급 + 번호 + 성별<br>
                   예) a1남, a2남, b1여, c3남 ...</p>
                <p><strong style="color: #ecf0f1;">백팀:</strong> 대문자 등급 + 번호 + 성별<br>
                   예) A1남, A2남, B1여, C3남 ...</p>
                
                <h3 style="color: #f39c12; margin: 20px 0 10px;">입력 방법</h3>
                <ul style="margin-left: 20px;">
                    <li>코트 수: 사용할 코트 개수</li>
                    <li>남자 비율: 전체 인원 중 남자 비율 (%)</li>
                    <li>등급별 인원: A~E 각 등급의 총 인원 수</li>
                </ul>
                
                <h3 style="color: #f39c12; margin: 20px 0 10px;">경기 종류</h3>
                <ul style="margin-left: 20px;">
                    <li><span style="color: #3498db;">MD (남복)</span>: 남자 2명 vs 남자 2명</li>
                    <li><span style="color: #e74c3c;">WD (여복)</span>: 여자 2명 vs 여자 2명</li>
                    <li><span style="color: #9b59b6;">XD (혼복)</span>: 남녀 1명씩 vs 남녀 1명씩</li>
                </ul>
                
                <h3 style="color: #f39c12; margin: 20px 0 10px;">대진표 규칙</h3>
                <ul style="margin-left: 20px;">
                    <li>청팀 vs 백팀으로 경기 진행</li>
                    <li>비슷한 실력끼리 경기 (실력 차이 1등급 이내)</li>
                    <li>선수당 4~5경기 배정</li>
                    <li>연속 경기 방지</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script>
        let scheduleData = null;
        let generatedPlayers = [];
        
        // 탭 전환
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
            });
        });
        
        // 입력 변경 시 미리보기 업데이트
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', updatePreview);
        });
        
        // 미리보기 업데이트
        function updatePreview() {
            const maleRatio = parseInt(document.getElementById('maleRatio').value) || 70;
            const grades = {
                A: parseInt(document.getElementById('gradeA').value) || 0,
                B: parseInt(document.getElementById('gradeB').value) || 0,
                C: parseInt(document.getElementById('gradeC').value) || 0,
                D: parseInt(document.getElementById('gradeD').value) || 0,
                E: parseInt(document.getElementById('gradeE').value) || 0
            };
            
            const total = Object.values(grades).reduce((a, b) => a + b, 0);
            const maleCount = Math.round(total * maleRatio / 100);
            const femaleCount = total - maleCount;
            
            // 청/백 균등 배분
            const blueTotal = Math.floor(total / 2);
            const whiteTotal = total - blueTotal;
            
            // 미리보기 텍스트 생성
            let bluePreview = [];
            let whitePreview = [];
            
            const gradeKeys = ['A', 'B', 'C', 'D', 'E'];
            gradeKeys.forEach(grade => {
                const count = grades[grade];
                if (count === 0) return;
                
                const blueCount = Math.floor(count / 2);
                const whiteCount = count - blueCount;
                
                const blueMale = Math.round(blueCount * maleRatio / 100);
                const blueFemale = blueCount - blueMale;
                const whiteMale = Math.round(whiteCount * maleRatio / 100);
                const whiteFemale = whiteCount - whiteMale;
                
                // 청팀 (소문자)
                const lowerGrade = grade.toLowerCase();
                if (blueMale > 0) bluePreview.push(lowerGrade + '1~' + blueMale + '남');
                if (blueFemale > 0) bluePreview.push(lowerGrade + '1~' + blueFemale + '여');
                
                // 백팀 (대문자)
                if (whiteMale > 0) whitePreview.push(grade + '1~' + whiteMale + '남');
                if (whiteFemale > 0) whitePreview.push(grade + '1~' + whiteFemale + '여');
            });
            
            document.getElementById('bluePreview').textContent = bluePreview.length > 0 ? bluePreview.join(', ') : '(없음)';
            document.getElementById('whitePreview').textContent = whitePreview.length > 0 ? whitePreview.join(', ') : '(없음)';
            document.getElementById('totalCount').textContent = total;
            document.getElementById('blueCount').textContent = blueTotal;
            document.getElementById('whiteCount').textContent = whiteTotal;
            document.getElementById('maleCount').textContent = maleCount;
            document.getElementById('femaleCount').textContent = femaleCount;
        }
        
        // 선수 생성
        function generatePlayers() {
            const maleRatio = parseInt(document.getElementById('maleRatio').value) || 70;
            const grades = {
                A: parseInt(document.getElementById('gradeA').value) || 0,
                B: parseInt(document.getElementById('gradeB').value) || 0,
                C: parseInt(document.getElementById('gradeC').value) || 0,
                D: parseInt(document.getElementById('gradeD').value) || 0,
                E: parseInt(document.getElementById('gradeE').value) || 0
            };
            
            const players = [];
            const gradeKeys = ['A', 'B', 'C', 'D', 'E'];
            
            gradeKeys.forEach(grade => {
                const count = grades[grade];
                if (count === 0) return;
                
                // 청/백 배분
                const blueCount = Math.floor(count / 2);
                const whiteCount = count - blueCount;
                
                // 청팀 남녀 배분
                const blueMale = Math.round(blueCount * maleRatio / 100);
                const blueFemale = blueCount - blueMale;
                
                // 백팀 남녀 배분
                const whiteMale = Math.round(whiteCount * maleRatio / 100);
                const whiteFemale = whiteCount - whiteMale;
                
                const lowerGrade = grade.toLowerCase();
                
                // 청팀 남자 (소문자)
                for (let i = 1; i <= blueMale; i++) {
                    players.push({
                        name: lowerGrade + i + '남',
                        gender: 'M',
                        grade: grade,
                        team: 'blue'
                    });
                }
                
                // 청팀 여자 (소문자)
                for (let i = 1; i <= blueFemale; i++) {
                    players.push({
                        name: lowerGrade + i + '여',
                        gender: 'F',
                        grade: grade,
                        team: 'blue'
                    });
                }
                
                // 백팀 남자 (대문자)
                for (let i = 1; i <= whiteMale; i++) {
                    players.push({
                        name: grade + i + '남',
                        gender: 'M',
                        grade: grade,
                        team: 'white'
                    });
                }
                
                // 백팀 여자 (대문자)
                for (let i = 1; i <= whiteFemale; i++) {
                    players.push({
                        name: grade + i + '여',
                        gender: 'F',
                        grade: grade,
                        team: 'white'
                    });
                }
            });
            
            return players;
        }
        
        // 대진표 생성
        async function generateSchedule() {
            generatedPlayers = generatePlayers();
            const numCourts = parseInt(document.getElementById('numCourts').value) || 6;
            
            if (generatedPlayers.length < 8) {
                alert('최소 8명의 선수가 필요합니다. 등급별 인원을 확인해주세요.');
                return;
            }
            
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ players: generatedPlayers, num_courts: numCourts })
                });
                const result = await response.json();
                
                if (result.success) {
                    await loadSchedule();
                    document.getElementById('resultSection').classList.add('active');
                    // 결과 섹션으로 스크롤
                    document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert(result.error);
                }
            } catch (error) {
                console.error('생성 오류:', error);
                alert('대진표 생성 중 오류가 발생했습니다.');
            }
        }
        
        // 대진표 재생성
        async function regenerateSchedule() {
            if (!confirm('대진표를 새로 생성하시겠습니까?')) return;
            
            try {
                await fetch('/api/regenerate', { method: 'POST' });
                await loadSchedule();
                alert('대진표가 재생성되었습니다!');
            } catch (error) {
                console.error('재생성 오류:', error);
            }
        }
        
        // 대진표 로드
        async function loadSchedule() {
            try {
                const response = await fetch('/api/schedule');
                scheduleData = await response.json();
                
                if (scheduleData.success) {
                    renderStats();
                    renderCourts();
                    renderPlayers();
                    renderStatsTab();
                }
            } catch (error) {
                console.error('로드 오류:', error);
            }
        }
        
        // 통계 렌더링
        function renderStats() {
            const stats = scheduleData.stats;
            document.getElementById('statsBar').innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${stats.total}</div>
                    <div class="stat-label">총 경기</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.by_type.MD || 0}</div>
                    <div class="stat-label">남자복식</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.by_type.WD || 0}</div>
                    <div class="stat-label">여자복식</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.by_type.XD || 0}</div>
                    <div class="stat-label">혼합복식</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.min_games}-${stats.max_games}</div>
                    <div class="stat-label">개인 경기수</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.total_rounds || '-'}</div>
                    <div class="stat-label">총 라운드</div>
                </div>
            `;
        }
        
        // 라운드별 대진표
        function renderCourts() {
            const matches = scheduleData.matches;
            const rounds = {};
            
            matches.forEach(m => {
                const roundNum = m.round || m.order;
                if (!rounds[roundNum]) rounds[roundNum] = [];
                rounds[roundNum].push(m);
            });
            
            let html = '';
            const roundNums = Object.keys(rounds).map(Number).sort((a, b) => a - b);
            
            roundNums.forEach(roundNum => {
                const roundMatches = rounds[roundNum];
                roundMatches.sort((a, b) => a.court - b.court);
                
                html += `
                    <div class="court">
                        <div class="court-header">
                            <span class="court-name">라운드 ${roundNum}</span>
                            <span class="court-count">${roundMatches.length}경기</span>
                        </div>
                `;
                
                roundMatches.forEach(m => {
                    html += `
                        <div class="match">
                            <span class="match-order">C${m.court}</span>
                            <span class="match-type ${m.type}">${m.type_name.substring(0, 2)}</span>
                            <div class="match-teams">
                                <span class="team blue">${m.team1.join(' + ')}</span>
                                <span class="vs">vs</span>
                                <span class="team white">${m.team2.join(' + ')}</span>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            });
            
            document.getElementById('courtsContainer').innerHTML = html;
        }
        
        // 선수 목록
        function renderPlayers() {
            const playerGames = scheduleData.player_games;
            
            const blueTeam = generatedPlayers.filter(p => p.team === 'blue');
            const whiteTeam = generatedPlayers.filter(p => p.team === 'white');
            
            function renderTeamSection(team, teamClass, title) {
                const grades = ['A', 'B', 'C', 'D', 'E'];
                let html = `
                    <div class="team-section ${teamClass}">
                        <h2 class="team-title" style="color: ${teamClass === 'blue-team' ? '#3498db' : '#ecf0f1'}; text-align: center; margin-bottom: 15px;">${title}</h2>
                `;
                
                grades.forEach(grade => {
                    const gradePlayers = team.filter(p => p.grade === grade);
                    if (gradePlayers.length === 0) return;
                    
                    html += `
                        <div class="grade-group">
                            <div class="grade-label">${grade}급</div>
                            <div class="player-list">
                    `;
                    
                    gradePlayers.forEach(p => {
                        const games = playerGames[p.name] || 0;
                        const genderClass = p.gender === 'M' ? 'male' : 'female';
                        html += `
                            <span class="player-chip ${genderClass}" onclick="showPlayerDetail('${p.name}')">
                                ${p.name}<span class="player-games">(${games})</span>
                            </span>
                        `;
                    });
                    
                    html += '</div></div>';
                });
                
                html += '</div>';
                return html;
            }
            
            document.getElementById('playersGrid').innerHTML =
                renderTeamSection(blueTeam, 'blue-team', `청팀 (${blueTeam.length}명)`) +
                renderTeamSection(whiteTeam, 'white-team', `백팀 (${whiteTeam.length}명)`);
        }
        
        // 통계 탭
        function renderStatsTab() {
            const stats = scheduleData.stats;
            const playerGames = scheduleData.player_games;
            const numCourts = parseInt(document.getElementById('numCourts').value);
            
            const gamesDist = {};
            Object.values(playerGames).forEach(g => {
                gamesDist[g] = (gamesDist[g] || 0) + 1;
            });
            
            let html = `
                <div class="stats-card">
                    <h3>경기 종류별</h3>
                    <div class="stats-row"><span>남자복식</span><span>${stats.by_type.MD || 0}경기</span></div>
                    <div class="stats-row"><span>여자복식</span><span>${stats.by_type.WD || 0}경기</span></div>
                    <div class="stats-row"><span>혼합복식</span><span>${stats.by_type.XD || 0}경기</span></div>
                </div>
                <div class="stats-card">
                    <h3>코트별 경기수</h3>
            `;
            
            for (let i = 1; i <= numCourts; i++) {
                html += `<div class="stats-row"><span>코트 ${i}</span><span>${stats.by_court[i] || 0}경기</span></div>`;
            }
            
            html += `
                </div>
                <div class="stats-card">
                    <h3>선수별 경기수 분포</h3>
            `;
            
            Object.keys(gamesDist).sort((a, b) => a - b).forEach(g => {
                html += `<div class="stats-row"><span>${g}경기</span><span>${gamesDist[g]}명</span></div>`;
            });
            
            html += '</div>';
            document.getElementById('statsGrid').innerHTML = html;
        }
        
        // 선수 상세
        async function showPlayerDetail(playerName) {
            try {
                const res = await fetch(`/api/player/${encodeURIComponent(playerName)}`);
                const data = await res.json();
                
                document.getElementById('modalTitle').textContent = `${playerName} (${data.total_games}경기)`;
                
                let html = '';
                data.matches.forEach((m, i) => {
                    const roundNum = m.round || m.order;
                    html += `
                        <div class="player-match">
                            <div><strong>경기 ${i + 1}</strong> - 라운드${roundNum} / 코트${m.court}</div>
                            <div>종류: ${m.type_name}</div>
                            <div>팀: ${m.team}팀 | 파트너: ${m.partner}</div>
                            <div>상대: ${m.opponents.join(' + ')}</div>
                        </div>
                    `;
                });
                
                document.getElementById('modalBody').innerHTML = html;
                document.getElementById('playerModal').classList.add('show');
            } catch (error) {
                console.error('선수 정보 로드 오류:', error);
            }
        }
        
        function closeModal() {
            document.getElementById('playerModal').classList.remove('show');
        }
        
        function showHelp() {
            document.getElementById('helpModal').classList.add('show');
        }
        
        function closeHelp() {
            document.getElementById('helpModal').classList.remove('show');
        }
        
        // 모달 바깥 클릭 시 닫기
        document.getElementById('playerModal').addEventListener('click', (e) => {
            if (e.target.id === 'playerModal') closeModal();
        });
        
        document.getElementById('helpModal').addEventListener('click', (e) => {
            if (e.target.id === 'helpModal') closeHelp();
        });
        
        // 초기 미리보기
        updatePreview();
    </script>
</body>
</html>
