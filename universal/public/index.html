<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Universal Language Learning</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        * {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 500px;
        }

        .game-card {
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .card-header-custom {
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .card-body-custom {
            padding: 25px;
        }

        .hidden {
            display: none !important;
        }

        /* ìƒíƒœ ë°” */
        .status-bar {
            display: flex;
            justify-content: space-around;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 15px;
            border-radius: 20px;
            margin-bottom: 15px;
        }

        .status-item {
            text-align: center;
        }

        .status-value {
            font-size: 1.5rem;
            font-weight: 900;
            color: #5f27cd;
        }

        .status-label {
            font-size: 0.75rem;
            color: #666;
            font-weight: 600;
        }

        /* ì–¸ì–´ ì„ íƒ í™”ë©´ */
        .language-select-card {
            background: linear-gradient(145deg, #fff, #f8f9fa);
            border: 3px solid #e0e0ff;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .language-select-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .language-select-card.selected {
            border-color: #667eea;
            background: linear-gradient(145deg, #f0f0ff, #fff);
        }

        .language-flag {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .language-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
        }

        /* ë©”ë‰´ ë²„íŠ¼ */
        .menu-btn {
            background: linear-gradient(145deg, #fff, #f0f0ff);
            border: 4px solid #e0e0ff;
            border-radius: 25px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .menu-btn:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 20px 40px rgba(255,107,107,0.3);
            border-color: #ff6b6b;
        }

        .menu-btn .icon {
            font-size: 4rem;
            margin-bottom: 10px;
            display: block;
            animation: bounce-icon 2s ease-in-out infinite;
        }

        @keyframes bounce-icon {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .menu-btn h4 {
            margin: 0;
            color: #333;
            font-weight: 800;
        }

        .menu-btn p {
            margin: 5px 0 0;
            color: #888;
            font-size: 0.85rem;
        }

        /* í€´ì¦ˆ ë²„íŠ¼ ìƒíƒœ */
        #quizMenuBtn {
            opacity: 0.6;
        }

        #quizMenuBtn.quiz-ready {
            opacity: 1;
            animation: pulse-ready 2s infinite;
        }

        @keyframes pulse-ready {
            0%, 100% { box-shadow: 0 5px 20px rgba(255,107,107,0.3); }
            50% { box-shadow: 0 5px 30px rgba(255,107,107,0.6); }
        }

        /* í”Œë˜ì‹œì¹´ë“œ */
        .flashcard {
            background: linear-gradient(145deg, #fff8e1, #fff);
            border: 5px solid #feca57;
            border-radius: 30px;
            padding: 40px 30px;
            text-align: center;
            min-height: 300px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .flashcard:hover {
            transform: scale(1.02);
            box-shadow: 0 15px 40px rgba(254,202,87,0.4);
        }

        .flashcard .word {
            font-size: 2.5rem;
            font-weight: 900;
            color: #5f27cd;
            margin-bottom: 10px;
        }

        .flashcard .reading {
            font-size: 1.2rem;
            color: #888;
            margin-bottom: 15px;
        }

        .flashcard .meaning {
            font-size: 2rem;
            font-weight: 800;
            color: #10ac84;
            margin-bottom: 15px;
        }

        .flashcard .example {
            font-size: 1rem;
            color: #666;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
            margin-top: 15px;
        }

        .flashcard .example-meaning {
            font-size: 0.9rem;
            color: #888;
            margin-top: 5px;
        }

        .flashcard .category-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
        }

        .flashcard .level-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
        }

        /* í€´ì¦ˆ ì˜µì…˜ */
        .quiz-option {
            background: linear-gradient(145deg, #f8f9fa, #fff);
            border: 3px solid #e0e0e0;
            border-radius: 20px;
            padding: 18px 25px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .quiz-option:hover {
            transform: translateX(10px);
            border-color: #667eea;
            background: linear-gradient(145deg, #f0f0ff, #fff);
        }

        .quiz-option.correct {
            background: linear-gradient(145deg, #d4edda, #c3e6cb);
            border-color: #28a745;
            color: #155724;
        }

        .quiz-option.wrong {
            background: linear-gradient(145deg, #f8d7da, #f5c6cb);
            border-color: #dc3545;
            color: #721c24;
        }

        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* í™ˆ ë²„íŠ¼ */
        .home-btn {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .home-btn:hover {
            transform: scale(1.1);
        }

        /* ìŠ¤í”¼ì»¤ ë²„íŠ¼ */
        .speak-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            border: none;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(255,107,107,0.4);
        }

        .speak-btn:hover {
            transform: scale(1.1);
        }

        /* ì§„í–‰ë°” */
        .progress-custom {
            height: 15px;
            border-radius: 10px;
            background: #e9ecef;
            overflow: hidden;
        }

        .progress-custom .progress-bar {
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.5s;
        }

        /* ê²°ê³¼ ì´ëª¨ì§€ */
        .result-emoji {
            font-size: 6rem;
            animation: bounce 1s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .result-score {
            font-size: 3rem;
            font-weight: 900;
            color: #5f27cd;
        }

        /* í˜„ì¬ ì–¸ì–´ í‘œì‹œ */
        .current-language {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            margin-bottom: 15px;
        }

        .current-language .flag {
            font-size: 1.5rem;
        }

        .current-language .arrow {
            color: white;
            font-weight: bold;
        }

        /* ì„¤ì • */
        .section-title {
            font-weight: 800;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-group .btn {
            font-weight: 700;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 400px) {
            .flashcard .word {
                font-size: 2rem;
            }
            .flashcard .meaning {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ì–¸ì–´ ì„ íƒ í™”ë©´ -->
        <div id="languageSelect" class="game-card hidden">
            <div class="card-header-custom">
                <h2 style="font-size: 1.8rem;">ğŸŒ Universal Language Learning ğŸŒ</h2>
                <p class="mb-0">Select your languages</p>
                <small class="opacity-75">v1.0.0 MVP</small>
            </div>
            <div class="card-body-custom">
                <h6 class="section-title">ğŸ  My Language (Native)</h6>
                <div id="nativeLanguageList" class="mb-4">
                    <!-- ë™ì  ìƒì„± -->
                </div>

                <h6 class="section-title">ğŸ“š Language to Learn (Target)</h6>
                <div id="targetLanguageList" class="mb-4">
                    <!-- ë™ì  ìƒì„± -->
                </div>

                <button id="startLearningBtn" class="btn btn-lg w-100 mb-2" onclick="startLearning()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 25px; font-weight: 800; padding: 18px;" disabled>
                    ğŸš€ Start Learning!
                </button>
                <button id="cancelLangBtn" class="btn btn-outline-secondary w-100 hidden" onclick="goHome()" style="border-radius: 25px; font-weight: 600;">
                    â† Back
                </button>
            </div>
        </div>

        <!-- ë©”ì¸ ë©”ë‰´ -->
        <div id="mainMenu" class="game-card hidden">
            <!-- ìƒíƒœ ë°” -->
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-value">Lv.<span id="level">1</span></div>
                    <div class="status-label">Level</div>
                </div>
                <div class="status-item">
                    <div class="status-value"><span id="xp">0</span></div>
                    <div class="status-label">XP</div>
                </div>
                <div class="status-item">
                    <div class="status-value"><span id="streak">0</span>ğŸ”¥</div>
                    <div class="status-label">Streak</div>
                </div>
                <div class="status-item">
                    <div class="status-value"><span id="totalScore">0</span></div>
                    <div class="status-label">Score</div>
                </div>
            </div>

            <!-- XP ë°” -->
            <div class="px-3 mb-3">
                <div class="progress progress-custom">
                    <div class="progress-bar" id="xpBar" style="width: 0%"></div>
                </div>
                <small class="text-muted">XP to next level <span id="xpToNext">100</span> XP</small>
            </div>

            <div class="card-header-custom">
                <div class="current-language" onclick="changeLanguage()" style="cursor: pointer;" title="Click to change language">
                    <span class="flag" id="nativeFlagDisplay">ğŸ‡ºğŸ‡¸</span>
                    <span class="arrow">âœ</span>
                    <span class="flag" id="targetFlagDisplay">ğŸ‡°ğŸ‡·</span>
                    <span style="font-size: 0.8rem; margin-left: 5px;">âœï¸</span>
                </div>
                <h2 style="font-size: 1.5rem;" id="learningTitle">English â†’ í•œêµ­ì–´</h2>
                <p class="mb-0" id="letsStudyText">Let's study hard!</p>
            </div>
            <div class="card-body-custom">
                <div class="row g-3">
                    <div class="col-6">
                        <div class="menu-btn" onclick="startFlashcard()">
                            <div class="icon">ğŸ“š</div>
                            <h4>Flashcards</h4>
                            <p>Memorize words</p>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="menu-btn" id="quizMenuBtn" onclick="startQuiz()">
                            <div class="icon">ğŸ¯</div>
                            <h4>Quiz</h4>
                            <p id="quizMenuDesc">Complete flashcards first!</p>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="menu-btn" onclick="showProgress()">
                            <div class="icon">ğŸ“Š</div>
                            <h4>Progress</h4>
                            <p>View your stats</p>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="menu-btn" onclick="showSettings()">
                            <div class="icon">âš™ï¸</div>
                            <h4>Settings</h4>
                            <p>Language/Level</p>
                        </div>
                    </div>
                </div>

                <!-- ì†Œë¦¬ í™œì„±í™” -->
                <div id="soundEnable" class="mt-3 p-4 rounded-4 text-center" style="background: linear-gradient(135deg, #ffeaa7, #fdcb6e); border: 3px dashed #f39c12;">
                    <button class="btn btn-lg" onclick="enableSound()" style="background: linear-gradient(135deg, #ff9ff3, #f368e0); color: white; border-radius: 25px; font-weight: 800; padding: 15px 30px;">
                        ğŸ”Š Enable Sound (Click first!) ğŸµ
                    </button>
                </div>

                <!-- ì˜¤ëŠ˜ì˜ ëª©í‘œ -->
                <div class="mt-4 p-4 rounded-4" style="background: linear-gradient(135deg, #dfe6e9, #b2bec3); border: 3px solid #74b9ff;">
                    <h6 style="font-weight: 800; color: #2d3436;">ğŸš€ Daily Goal ğŸ¯</h6>
                    <div class="progress progress-custom mb-2" style="height: 20px;">
                        <div class="progress-bar" id="dailyProgress" style="width: 0%"></div>
                    </div>
                    <small style="font-weight: 600; color: #636e72;">â­ <span id="todayLearned">0</span> / <span id="dailyGoal">20</span> words learned â­</small>
                </div>
            </div>
        </div>

        <!-- í”Œë˜ì‹œì¹´ë“œ ëª¨ë“œ -->
        <div id="flashcardMode" class="game-card hidden">
            <div class="card-header-custom">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="home-btn" onclick="goHome()">ğŸ </button>
                    <span class="progress-counter">ğŸ“– <span id="fcCurrent">1</span> / <span id="fcTotal">10</span></span>
                    <span class="category-tag" id="fcCategory">Category</span>
                </div>
            </div>
            <div class="card-body-custom">
                <div class="flashcard" id="flashcard" onclick="flipCard()">
                    <span class="level-badge" id="fcLevel">Lv.1</span>
                    <span class="category-badge" id="fcCategoryBadge">ì¸ì‚¬</span>
                    <div id="cardFront">
                        <div class="word" id="fcWord">ã“ã‚“ã«ã¡ã¯</div>
                        <div class="reading" id="fcReading">konnichiwa</div>
                        <button class="speak-btn" onclick="event.stopPropagation(); speakWord()">
                            <i class="bi bi-volume-up-fill"></i>
                        </button>
                        <small class="text-muted d-block mt-3">Tap card to see meaning</small>
                    </div>
                    <div id="cardBack" class="hidden">
                        <div class="meaning" id="fcMeaning">ì•ˆë…•í•˜ì„¸ìš”</div>
                        <div class="d-flex justify-content-center gap-2 my-3">
                            <button class="speak-btn" onclick="event.stopPropagation(); speakWord()" title="Pronounce word">
                                <i class="bi bi-volume-up-fill"></i>
                            </button>
                            <button class="speak-btn" onclick="event.stopPropagation(); speakExample()" title="Listen to example" style="background: #22c55e;">
                                <i class="bi bi-chat-quote-fill"></i>
                            </button>
                        </div>
                        <div class="example" id="fcExample">"ã“ã‚“ã«ã¡ã¯ã€ãŠå…ƒæ°—ã§ã™ã‹ï¼Ÿ"</div>
                        <div class="example-meaning" id="fcExampleMeaning">ì•ˆë…•í•˜ì„¸ìš”, ì˜ ì§€ë‚´ì„¸ìš”?</div>
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-4 gap-3">
                    <button class="btn btn-lg" onclick="markUnknown()" style="background: linear-gradient(135deg, #ff6b6b, #ee5a5a); color: white; border-radius: 20px; font-weight: 700; padding: 15px 25px;">
                        ğŸ˜… Study again
                    </button>
                    <button class="btn btn-lg" onclick="markKnown()" style="background: linear-gradient(135deg, #00d2d3, #10ac84); color: white; border-radius: 20px; font-weight: 700; padding: 15px 25px;">
                        ğŸ‰ I know it! (+10 XP)
                    </button>
                </div>

                <div class="progress progress-custom mt-3">
                    <div class="progress-bar" id="fcProgress" style="width: 10%"></div>
                </div>
            </div>
        </div>

        <!-- í€´ì¦ˆ ëª¨ë“œ -->
        <div id="quizMode" class="game-card hidden">
            <div class="card-header-custom">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="home-btn" onclick="goHome()">ğŸ </button>
                    <span class="progress-counter">ğŸ¯ <span id="qCurrent">1</span> / <span id="qTotal">10</span></span>
                    <span class="score-badge">â­ <span id="qScore">0</span>ì </span>
                </div>
            </div>
            <div class="card-body-custom">
                <div class="text-center mb-4">
                    <button class="speak-btn" onclick="speakQuizWord()">
                        <i class="bi bi-volume-up-fill"></i>
                    </button>
                    <h3 class="mt-2" id="quizWord" style="font-size: 2.5rem; font-weight: 900; color: #5f27cd;">ã“ã‚“ã«ã¡ã¯</h3>
                    <p class="text-muted" id="quizReading">konnichiwa</p>
                    <p style="color: #888; font-weight: 600;">ğŸ‘† What does this word mean? ğŸ‘†</p>
                </div>

                <div id="quizOptions">
                    <!-- ë™ì  ìƒì„± -->
                </div>

                <div id="quizFeedback" class="hidden mt-3 p-3 rounded-4">
                    <p id="feedbackText" class="mb-2 fw-bold"></p>
                    <p id="feedbackExample" class="mb-0 small text-muted"></p>
                </div>

                <button id="nextQuizBtn" class="btn btn-lg w-100 mt-3 hidden" onclick="nextQuiz()" style="background: linear-gradient(135deg, #00d2d3, #10ac84); color: white; border-radius: 25px; font-weight: 800; padding: 18px;">
                    â¡ï¸ Next Question
                </button>

                <div class="progress progress-custom mt-3">
                    <div class="progress-bar" id="qProgress" style="width: 10%"></div>
                </div>
            </div>
        </div>

        <!-- í”Œë˜ì‹œì¹´ë“œ ì™„ë£Œ -->
        <div id="flashcardComplete" class="game-card hidden">
            <div class="card-body-custom text-center">
                <div class="result-emoji">ğŸ“š</div>
                <h2>Complete!</h2>
                <p class="text-muted mb-4">
                    <span id="fcLearnedCount">0</span> words studied
                </p>

                <div class="p-3 bg-light rounded-3 mb-4">
                    <div class="d-flex justify-content-around">
                        <div>
                            <h4 class="text-success mb-0">+<span id="fcEarnedXP">0</span></h4>
                            <small class="text-muted">Earned XP</small>
                        </div>
                        <div>
                            <h4 class="text-primary mb-0"><span id="fcStudiedCount">10</span></h4>
                            <small class="text-muted">Studied</small>
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-3">
                    <button class="btn btn-lg" onclick="startQuizFromFlashcard()" style="background: linear-gradient(135deg, #feca57, #ff9f43); color: white; border-radius: 25px; font-weight: 800; padding: 18px 30px;">
                        âš¡ Quiz with these words! âš¡
                    </button>
                    <button class="btn btn-lg" onclick="goHome()" style="background: linear-gradient(135deg, #74b9ff, #0984e3); color: white; border-radius: 25px; font-weight: 800; padding: 15px 30px;">
                        ğŸ  Go Home
                    </button>
                </div>
            </div>
        </div>

        <!-- í€´ì¦ˆ ê²°ê³¼ -->
        <div id="quizResult" class="game-card hidden">
            <div class="card-body-custom text-center">
                <div class="result-emoji" id="resultEmoji">ğŸ‰</div>
                <h2 id="resultTitle">Excellent!</h2>
                <div class="result-score" id="resultScore">8/10</div>
                <p class="text-muted mb-4">Accuracy <span id="resultPercent">80</span>%</p>

                <div class="p-3 bg-light rounded-3 mb-4">
                    <div class="d-flex justify-content-around">
                        <div>
                            <h4 class="text-success mb-0">+<span id="earnedXP">100</span></h4>
                            <small class="text-muted">Earned XP</small>
                        </div>
                        <div>
                            <h4 class="text-primary mb-0">+<span id="earnedScore">80</span></h4>
                            <small class="text-muted">Earned Score</small>
                        </div>
                    </div>
                </div>

                <div class="d-flex gap-3">
                    <button class="btn btn-lg flex-fill" onclick="goHome()" style="background: linear-gradient(135deg, #74b9ff, #0984e3); color: white; border-radius: 20px; font-weight: 800; padding: 15px;">
                        ğŸ  Home
                    </button>
                    <button class="btn btn-lg flex-fill" onclick="retryQuiz()" style="background: linear-gradient(135deg, #ff6b6b, #ee5a5a); color: white; border-radius: 20px; font-weight: 800; padding: 15px;">
                        ğŸ”„ Try Again!
                    </button>
                </div>
            </div>
        </div>

        <!-- ì§„í–‰ ìƒí™© -->
        <div id="progressView" class="game-card hidden">
            <div class="card-header-custom">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="home-btn" onclick="goHome()">ğŸ </button>
                    <h5 class="mb-0">ğŸ† My Progress ğŸ†</h5>
                    <span></span>
                </div>
            </div>
            <div class="card-body-custom">
                <div class="text-center mb-4">
                    <h4>ğŸ“– Words Learned</h4>
                    <div class="result-score"><span id="learnedWords">0</span></div>
                    <div class="progress progress-custom mt-2">
                        <div class="progress-bar" id="totalProgress" style="width: 0%"></div>
                    </div>
                    <small class="text-muted">Total Progress: <span id="learnedPercent">0</span>%</small>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-6">
                        <div class="p-3 bg-light rounded-3 text-center">
                            <h5 class="text-primary mb-0"><span id="statQuizzes">0</span></h5>
                            <small class="text-muted">Quizzes Completed</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="p-3 bg-light rounded-3 text-center">
                            <h5 class="text-success mb-0"><span id="statAccuracy">0</span>%</h5>
                            <small class="text-muted">Accuracy</small>
                        </div>
                    </div>
                </div>

                <!-- ë©”ë‹¬ í‘œì‹œ -->
                <div class="p-3 bg-light rounded-3 mb-3">
                    <h6 class="fw-bold mb-3">ğŸ… Medal Collection</h6>
                    <div class="d-flex justify-content-around">
                        <div class="text-center">
                            <div style="font-size: 2rem;">ğŸ¥‰</div>
                            <div class="fw-bold" id="bronzeCount">0</div>
                            <small class="text-muted">Bronze</small>
                        </div>
                        <div class="text-center">
                            <div style="font-size: 2rem;">ğŸ¥ˆ</div>
                            <div class="fw-bold" id="silverCount">0</div>
                            <small class="text-muted">Silver</small>
                        </div>
                        <div class="text-center">
                            <div style="font-size: 2rem;">ğŸ¥‡</div>
                            <div class="fw-bold" id="goldCount">0</div>
                            <small class="text-muted">Gold</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì„¤ì • -->
        <div id="settingsView" class="game-card hidden">
            <div class="card-header-custom">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="home-btn" onclick="goHome()">ğŸ </button>
                    <h5 class="mb-0">âš™ï¸ Settings</h5>
                    <span></span>
                </div>
            </div>
            <div class="card-body-custom">
                <h6 class="section-title">ğŸŒ Change Language</h6>
                <button class="btn btn-outline-primary w-100 mb-4" onclick="changeLanguage()">
                    Change Language
                </button>

                <h6 class="section-title">ğŸ“š Select Learning Level</h6>
                <div class="mb-3" id="levelSelect">
                    <!-- ë™ì  ìƒì„± -->
                </div>

                <h6 class="section-title mt-4">ğŸ¯ Daily Goal</h6>
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="dailyGoal" id="goal10" value="10">
                    <label class="btn btn-outline-primary" for="goal10">10</label>
                    <input type="radio" class="btn-check" name="dailyGoal" id="goal20" value="20" checked>
                    <label class="btn btn-outline-primary" for="goal20">20</label>
                    <input type="radio" class="btn-check" name="dailyGoal" id="goal30" value="30">
                    <label class="btn btn-outline-primary" for="goal30">30</label>
                </div>

                <h6 class="section-title mt-4">ğŸ“– Words per Session</h6>
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="wordCount" id="word10" value="10" checked>
                    <label class="btn btn-outline-primary" for="word10">10</label>
                    <input type="radio" class="btn-check" name="wordCount" id="word20" value="20">
                    <label class="btn btn-outline-primary" for="word20">20</label>
                    <input type="radio" class="btn-check" name="wordCount" id="word30" value="30">
                    <label class="btn btn-outline-primary" for="word30">30</label>
                </div>

                <button class="btn btn-lg w-100 mt-4" onclick="saveSettings()" style="background: linear-gradient(135deg, #00d2d3, #10ac84); color: white; border-radius: 20px; font-weight: 800;">
                    âœ… Save Settings
                </button>

                <hr class="my-4">

                <button class="btn btn-outline-info w-100 mb-3" onclick="showHelp()" id="helpBtn">
                    â“ Help
                </button>

                <button class="btn btn-outline-danger w-100" onclick="resetProgress()">
                    ğŸ—‘ï¸ Reset Progress
                </button>
            </div>
        </div>

        <!-- ë„ì›€ë§ -->
        <div id="helpView" class="game-card hidden">
            <div class="card-header-custom">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="home-btn" onclick="showSettings()">â¬…ï¸</button>
                    <h5 class="mb-0" id="helpTitle">â“ Help</h5>
                    <span></span>
                </div>
            </div>
            <div class="card-body-custom" style="max-height: 70vh; overflow-y: auto;">
                <div class="text-center mb-4">
                    <h4 id="howToUseTitle">ğŸ“– How to Use</h4>
                    <p class="text-muted" id="helpIntroText">Welcome to Universal Language Learning!</p>
                </div>

                <!-- í”Œë˜ì‹œì¹´ë“œ ì„¹ì…˜ -->
                <div class="help-section mb-4 p-3 bg-light rounded-3">
                    <h6 class="fw-bold text-primary" id="helpFlashcardTitle">ğŸ“š Using Flashcards</h6>
                    <p class="mb-0 small" id="helpFlashcardContent" style="white-space: pre-line;"></p>
                </div>

                <!-- í€´ì¦ˆ ì„¹ì…˜ -->
                <div class="help-section mb-4 p-3 bg-light rounded-3">
                    <h6 class="fw-bold text-success" id="helpQuizTitle">ğŸ¯ Taking Quizzes</h6>
                    <p class="mb-0 small" id="helpQuizContent" style="white-space: pre-line;"></p>
                </div>

                <!-- XP ì„¹ì…˜ -->
                <div class="help-section mb-4 p-3 bg-light rounded-3">
                    <h6 class="fw-bold text-warning" id="helpXPTitle">â­ XP and Levels</h6>
                    <p class="mb-0 small" id="helpXPContent" style="white-space: pre-line;"></p>
                </div>

                <!-- íŒ ì„¹ì…˜ -->
                <div class="help-section mb-4 p-3 bg-light rounded-3">
                    <h6 class="fw-bold text-info" id="helpTipsTitle">ğŸ’¡ Learning Tips</h6>
                    <p class="mb-0 small" id="helpTipsContent" style="white-space: pre-line;"></p>
                </div>

                <!-- ì„¤ì • ì„¹ì…˜ -->
                <div class="help-section mb-4 p-3 bg-light rounded-3">
                    <h6 class="fw-bold text-secondary" id="helpSettingsTitle">âš™ï¸ Settings Guide</h6>
                    <p class="mb-0 small" id="helpSettingsContent" style="white-space: pre-line;"></p>
                </div>

                <button class="btn btn-lg w-100 mt-3" onclick="showSettings()" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 20px; font-weight: 800;" id="backToSettingsBtn">
                    â¬…ï¸ Back to Settings
                </button>
            </div>
        </div>
    </div>

    <script src="words/words-ui.js"></script>
    <script>
        // ===== ì–¸ì–´ ì„¤ì • =====
        let selectedNative = null;
        let selectedTarget = null;
        let currentWordDatabase = [];
        let currentUI = getUI('en'); // ê¸°ë³¸ UI ì–¸ì–´ (ì˜ì–´)

        // ===== ì˜¤ë””ì˜¤ ë§¤í•‘ =====
        let audioMapping = null;
        fetch('audio/mapping.json')
            .then(r => r.json())
            .then(data => { audioMapping = data; })
            .catch(() => { audioMapping = null; });

        // ===== ê²Œì„ ìƒíƒœ =====
        let gameState = {
            nativeLanguage: null,
            targetLanguage: null,
            xp: 0,
            level: 1,
            totalScore: 0,
            streak: 0,
            lastStudyDate: null,
            todayLearned: 0,
            dailyGoal: 20,
            wordCount: 10,
            selectedLevels: [1, 2, 3, 4, 5],
            learnedWords: [],
            quizzesCompleted: 0,
            totalCorrect: 0,
            totalAnswered: 0,
            medals: { bronze: 0, silver: 0, gold: 0 }
        };

        // í”Œë˜ì‹œì¹´ë“œ ìƒíƒœ
        let fcState = {
            words: [],
            currentIndex: 0,
            isFlipped: false,
            studiedWords: [],
            earnedXP: 0,
            completed: false
        };

        // í€´ì¦ˆ ìƒíƒœ
        let quizState = {
            words: [],
            currentIndex: 0,
            score: 0,
            answered: false,
            currentWord: null
        };

        // ===== ì´ˆê¸°í™” =====
        function init() {
            loadGameState();

            // ê¸°ë³¸ê°’ ì„¤ì •: ì˜ì–´ â†’ í•œêµ­ì–´
            if (!gameState.nativeLanguage || !gameState.targetLanguage) {
                gameState.nativeLanguage = 'en';
                gameState.targetLanguage = 'ko';
                saveGameState();
            }

            // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
            selectedNative = gameState.nativeLanguage;
            selectedTarget = gameState.targetLanguage;
            currentUI = getUI(selectedNative); // UI ì–¸ì–´ ì„¤ì •

            // ì–¸ì–´ ì„ íƒ í™”ë©´ ì¤€ë¹„ (ì„¤ì •ì—ì„œ ì‚¬ìš©)
            renderLanguageSelection();

            // ë‹¨ì–´ ë°ì´í„° ë™ì  ë¡œë”© í›„ ë©”ì¸ ë©”ë‰´ë¡œ
            loadWordPack(selectedNative, selectedTarget).then(words => {
                currentWordDatabase = words;
                // ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•˜ì—¬ UI ì–¸ì–´ ì„¤ì •
                currentUI = getUI(selectedNative);
                showMainMenu();
            }).catch(err => {
                console.error('Failed to load word pack:', err);
                currentWordDatabase = [];
                // ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•˜ì—¬ UI ì–¸ì–´ ì„¤ì •
                currentUI = getUI(selectedNative);
                showMainMenu();
            });
        }

        function loadGameState() {
            const saved = localStorage.getItem('universalLanguageGame');
            if (saved) {
                const parsed = JSON.parse(saved);
                gameState = { ...gameState, ...parsed };
            }
        }

        function saveGameState() {
            localStorage.setItem('universalLanguageGame', JSON.stringify(gameState));
        }

        // ===== UI ì–¸ì–´ ì—…ë°ì´íŠ¸ =====
        function updateUILanguage() {
            // ì–¸ì–´ ì„ íƒ í™”ë©´
            document.querySelector('#languageSelect .card-header-custom p').textContent = currentUI.selectLanguage;

            // ë‚˜ì˜ ì–¸ì–´ / ë°°ìš°ê³  ì‹¶ì€ ì–¸ì–´ ì œëª©
            const sectionTitles = document.querySelectorAll('#languageSelect .section-title');
            if (sectionTitles[0]) sectionTitles[0].innerHTML = 'ğŸ  ' + currentUI.myLanguage;
            if (sectionTitles[1]) sectionTitles[1].innerHTML = 'ğŸ“š ' + currentUI.targetLanguage;

            // ì‹œì‘ ë²„íŠ¼
            const startBtn = document.getElementById('startLearningBtn');
            if (startBtn && !selectedTarget) {
                startBtn.innerHTML = 'ğŸš€ ' + currentUI.startLearning;
            }

            // ë©”ì¸ ë©”ë‰´ ë²„íŠ¼ë“¤
            const flashcardBtn = document.querySelector('[onclick="startFlashcard()"]');
            if (flashcardBtn) {
                flashcardBtn.querySelector('h4').textContent = currentUI.flashcard;
                flashcardBtn.querySelector('p').textContent = currentUI.flashcardDesc;
            }

            const quizBtn = document.getElementById('quizMenuBtn');
            if (quizBtn) {
                quizBtn.querySelector('h4').textContent = currentUI.quiz;
            }

            const progressBtn = document.querySelector('[onclick="showProgress()"]');
            if (progressBtn) {
                progressBtn.querySelector('h4').textContent = currentUI.progress;
                progressBtn.querySelector('p').textContent = currentUI.progressDesc;
            }

            const settingsBtn = document.querySelector('[onclick="showSettings()"]');
            if (settingsBtn) {
                settingsBtn.querySelector('h4').textContent = currentUI.settings;
                settingsBtn.querySelector('p').textContent = currentUI.settingsDesc;
            }

            // ì†Œë¦¬ ë²„íŠ¼
            const soundBtn = document.querySelector('#soundEnable button');
            if (soundBtn) soundBtn.innerHTML = 'ğŸ”Š ' + currentUI.enableSound + ' ğŸµ';

            // ì˜¤ëŠ˜ì˜ ëª©í‘œ
            const dailyGoalTitle = document.querySelector('#mainMenu [style*="dfe6e9"] h6');
            if (dailyGoalTitle) dailyGoalTitle.innerHTML = 'ğŸš€ ' + currentUI.dailyGoal + ' ğŸ¯';

            const dailyGoalText = document.querySelector('#mainMenu [style*="dfe6e9"] small');
            if (dailyGoalText) {
                const today = document.getElementById('todayLearned')?.textContent || '0';
                const goal = document.getElementById('dailyGoal')?.textContent || '20';
                dailyGoalText.innerHTML = `â­ <span id="todayLearned">${today}</span> / <span id="dailyGoal">${goal}</span> ${currentUI.wordsLearned} â­`;
            }

            // ìƒíƒœë°” ë¼ë²¨
            const statusLabels = document.querySelectorAll('.status-label');
            if (statusLabels[0]) statusLabels[0].textContent = currentUI.level;
            if (statusLabels[1]) statusLabels[1].textContent = 'XP';
            if (statusLabels[2]) statusLabels[2].textContent = currentUI.streak;
            if (statusLabels[3]) statusLabels[3].textContent = currentUI.score;

            // XP ë°” í…ìŠ¤íŠ¸
            const xpText = document.querySelector('#mainMenu .px-3 small');
            if (xpText) {
                const xpToNext = document.getElementById('xpToNext').textContent;
                xpText.innerHTML = currentUI.xpToNext + ' <span id="xpToNext">' + xpToNext + '</span> XP';
            }

            // í”Œë˜ì‹œì¹´ë“œ ëª¨ë“œ
            const fcTapHint = document.querySelector('#cardFront small');
            if (fcTapHint) fcTapHint.textContent = currentUI.tapToSee;

            const fcStudyAgainBtn = document.querySelector('[onclick="markUnknown()"]');
            if (fcStudyAgainBtn) fcStudyAgainBtn.innerHTML = 'ğŸ˜… ' + currentUI.studyAgain;

            const fcKnowBtn = document.querySelector('[onclick="markKnown()"]');
            if (fcKnowBtn) fcKnowBtn.innerHTML = 'ğŸ‰ ' + currentUI.iKnow;

            // í€´ì¦ˆ ëª¨ë“œ
            const quizMeaningHint = document.querySelector('#quizMode p[style*="888"]');
            if (quizMeaningHint) quizMeaningHint.innerHTML = 'ğŸ‘† ' + currentUI.questionMeaning + ' ğŸ‘†';

            const nextQuizBtn = document.getElementById('nextQuizBtn');
            if (nextQuizBtn) nextQuizBtn.innerHTML = 'â¡ï¸ ' + currentUI.nextQuestion;

            // í”Œë˜ì‹œì¹´ë“œ ì™„ë£Œ í™”ë©´
            const fcCompleteTitle = document.querySelector('#flashcardComplete h2');
            if (fcCompleteTitle) fcCompleteTitle.textContent = currentUI.complete;

            const fcCompleteDesc = document.querySelector('#flashcardComplete p.text-muted');
            if (fcCompleteDesc) {
                const count = document.getElementById('fcLearnedCount')?.textContent || '0';
                // ë‹¤ì–‘í•œ ì–¸ì–´ ì§€ì›ì„ ìœ„í•œ í¬ë§· (í•œêµ­ì–´: 5ê°œ, ì˜ì–´: 5 words ë“±)
                fcCompleteDesc.innerHTML = '<span id="fcLearnedCount">' + count + '</span>' + currentUI.wordsStudied;
            }

            const fcXpLabel = document.querySelector('#flashcardComplete [class*="text-success"] + small');
            if (fcXpLabel) fcXpLabel.textContent = currentUI.earnedXP;

            const fcWordLabel = document.querySelector('#flashcardComplete [class*="text-primary"] + small');
            if (fcWordLabel) fcWordLabel.textContent = currentUI.studiedWords;

            const fcQuizNowBtn = document.querySelector('[onclick="startQuizFromFlashcard()"]');
            if (fcQuizNowBtn) fcQuizNowBtn.innerHTML = 'âš¡ ' + currentUI.quizNow + ' âš¡';

            const fcGoHomeBtn = document.querySelector('#flashcardComplete [onclick="goHome()"]');
            if (fcGoHomeBtn) fcGoHomeBtn.innerHTML = 'ğŸ  ' + currentUI.goHome;

            // í€´ì¦ˆ ê²°ê³¼ í™”ë©´
            const quizResultAccuracy = document.querySelector('#quizResult p.text-muted');
            if (quizResultAccuracy) {
                const percent = document.getElementById('resultPercent')?.textContent || '0';
                quizResultAccuracy.innerHTML = currentUI.accuracy + ' <span id="resultPercent">' + percent + '</span>%';
            }

            const qrXpLabel = document.querySelector('#quizResult [class*="text-success"] + small');
            if (qrXpLabel) qrXpLabel.textContent = currentUI.earnedXP;

            const qrScoreLabel = document.querySelector('#quizResult [class*="text-primary"] + small');
            if (qrScoreLabel) qrScoreLabel.textContent = currentUI.earnedScore;

            const qrHomeBtn = document.querySelector('#quizResult [onclick="goHome()"]');
            if (qrHomeBtn) qrHomeBtn.innerHTML = 'ğŸ  ' + currentUI.home;

            const qrRetryBtn = document.querySelector('[onclick="retryQuiz()"]');
            if (qrRetryBtn) qrRetryBtn.innerHTML = 'ğŸ”„ ' + currentUI.retry;

            // ì§„í–‰ ìƒí™© í™”ë©´
            const progressTitle = document.querySelector('#progressView h5');
            if (progressTitle) progressTitle.innerHTML = 'ğŸ† ' + currentUI.myProgress + ' ğŸ†';

            const learnedWordsTitle = document.querySelector('#progressView h4');
            if (learnedWordsTitle) learnedWordsTitle.innerHTML = 'ğŸ“– ' + currentUI.learnedWords;

            const progressPercent = document.querySelector('#progressView small.text-muted');
            if (progressPercent) {
                const pct = document.getElementById('learnedPercent')?.textContent || '0';
                progressPercent.innerHTML = currentUI.totalProgress + ': <span id="learnedPercent">' + pct + '</span>%';
            }

            const quizzesLabel = document.querySelector('#statQuizzes')?.nextElementSibling;
            if (quizzesLabel) quizzesLabel.textContent = currentUI.quizzesCompleted;

            const accuracyLabel = document.querySelector('#statAccuracy')?.nextElementSibling;
            if (accuracyLabel) accuracyLabel.textContent = currentUI.accuracy;

            const medalTitle = document.querySelector('#progressView .bg-light h6');
            if (medalTitle) medalTitle.innerHTML = 'ğŸ… ' + currentUI.medalCollection;

            const bronzeLabel = document.querySelector('#bronzeCount')?.nextElementSibling;
            if (bronzeLabel) bronzeLabel.textContent = currentUI.bronze;

            const silverLabel = document.querySelector('#silverCount')?.nextElementSibling;
            if (silverLabel) silverLabel.textContent = currentUI.silver;

            const goldLabel = document.querySelector('#goldCount')?.nextElementSibling;
            if (goldLabel) goldLabel.textContent = currentUI.gold;

            // ì„¤ì • í™”ë©´
            const settingsTitle = document.querySelector('#settingsView h5');
            if (settingsTitle) settingsTitle.innerHTML = 'âš™ï¸ ' + currentUI.settings;

            const settingsSections = document.querySelectorAll('#settingsView .section-title');
            if (settingsSections[0]) settingsSections[0].innerHTML = 'ğŸŒ ' + currentUI.changeLanguage;
            if (settingsSections[1]) settingsSections[1].innerHTML = 'ğŸ“š ' + currentUI.selectLevel;
            if (settingsSections[2]) settingsSections[2].innerHTML = 'ğŸ¯ ' + currentUI.dailyGoalSetting;
            if (settingsSections[3]) settingsSections[3].innerHTML = 'ğŸ“– ' + currentUI.wordCount;

            const changeLangBtn = document.querySelector('[onclick="changeLanguage()"]');
            if (changeLangBtn) changeLangBtn.textContent = currentUI.changeLanguage;

            const saveSettingsBtn = document.querySelector('[onclick="saveSettings()"]');
            if (saveSettingsBtn) saveSettingsBtn.innerHTML = 'âœ… ' + currentUI.saveSettings;

            const helpBtn = document.getElementById('helpBtn');
            if (helpBtn) helpBtn.innerHTML = 'â“ ' + currentUI.help;

            const resetBtn = document.querySelector('[onclick="resetProgress()"]');
            if (resetBtn) resetBtn.innerHTML = 'ğŸ—‘ï¸ ' + currentUI.resetProgress;

            // ë„ì›€ë§ í™”ë©´
            const helpTitle = document.getElementById('helpTitle');
            if (helpTitle) helpTitle.innerHTML = 'â“ ' + currentUI.help;

            const howToUseTitle = document.getElementById('howToUseTitle');
            if (howToUseTitle) howToUseTitle.textContent = currentUI.howToUse;

            const helpIntroText = document.getElementById('helpIntroText');
            if (helpIntroText) helpIntroText.textContent = currentUI.helpIntro;

            const helpFlashcardTitle = document.getElementById('helpFlashcardTitle');
            if (helpFlashcardTitle) helpFlashcardTitle.textContent = currentUI.helpFlashcardTitle;

            const helpFlashcardContent = document.getElementById('helpFlashcardContent');
            if (helpFlashcardContent) helpFlashcardContent.textContent = currentUI.helpFlashcardContent;

            const helpQuizTitle = document.getElementById('helpQuizTitle');
            if (helpQuizTitle) helpQuizTitle.textContent = currentUI.helpQuizTitle;

            const helpQuizContent = document.getElementById('helpQuizContent');
            if (helpQuizContent) helpQuizContent.textContent = currentUI.helpQuizContent;

            const helpXPTitle = document.getElementById('helpXPTitle');
            if (helpXPTitle) helpXPTitle.textContent = currentUI.helpXPTitle;

            const helpXPContent = document.getElementById('helpXPContent');
            if (helpXPContent) helpXPContent.textContent = currentUI.helpXPContent;

            const helpTipsTitle = document.getElementById('helpTipsTitle');
            if (helpTipsTitle) helpTipsTitle.textContent = currentUI.helpTipsTitle;

            const helpTipsContent = document.getElementById('helpTipsContent');
            if (helpTipsContent) helpTipsContent.textContent = currentUI.helpTipsContent;

            const helpSettingsTitle = document.getElementById('helpSettingsTitle');
            if (helpSettingsTitle) helpSettingsTitle.textContent = currentUI.helpSettingsTitle;

            const helpSettingsContent = document.getElementById('helpSettingsContent');
            if (helpSettingsContent) helpSettingsContent.textContent = currentUI.helpSettingsContent;

            const backToSettingsBtn = document.getElementById('backToSettingsBtn');
            if (backToSettingsBtn) backToSettingsBtn.innerHTML = 'â¬…ï¸ ' + currentUI.backToSettings;
        }

        // ===== ì–¸ì–´ ì„ íƒ =====
        function renderLanguageSelection() {
            const languages = getSupportedLanguages();
            const combinations = getAvailableCombinations();

            // í˜„ì§€ì¸ ì–¸ì–´ (Native) - ì‚¬ìš© ê°€ëŠ¥í•œ ê²ƒë§Œ
            const nativeLanguages = [...new Set(combinations.map(c => c.native))];
            let nativeHtml = '<div class="row g-2">';
            nativeLanguages.forEach(code => {
                const lang = languages[code];
                nativeHtml += `
                    <div class="col-4">
                        <div class="language-select-card text-center" id="native-${code}" onclick="selectNativeLanguage('${code}')">
                            <div class="language-flag">${lang.flag}</div>
                            <div class="language-name">${lang.name}</div>
                        </div>
                    </div>
                `;
            });
            nativeHtml += '</div>';
            document.getElementById('nativeLanguageList').innerHTML = nativeHtml;

            // í•™ìŠµ ì–¸ì–´ëŠ” í˜„ì§€ì–´ ì„ íƒ í›„ í‘œì‹œ
            document.getElementById('targetLanguageList').innerHTML = '<p class="text-muted text-center">' + currentUI.selectMyLanguageFirst + '</p>';

            // UI ì–¸ì–´ ì—…ë°ì´íŠ¸
            updateUILanguage();
        }

        function selectNativeLanguage(code) {
            selectedNative = code;
            currentUI = getUI(code); // UI ì–¸ì–´ ë³€ê²½

            // ì„ íƒ í‘œì‹œ
            document.querySelectorAll('#nativeLanguageList .language-select-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById(`native-${code}`).classList.add('selected');

            // UI ì–¸ì–´ ì—…ë°ì´íŠ¸
            updateUILanguage();

            // í•™ìŠµ ê°€ëŠ¥í•œ ì–¸ì–´ í‘œì‹œ
            renderTargetLanguages();
            updateStartButton();
        }

        function renderTargetLanguages() {
            const languages = getSupportedLanguages();
            const combinations = getAvailableCombinations();

            // ì„ íƒëœ í˜„ì§€ì–´ì—ì„œ í•™ìŠµ ê°€ëŠ¥í•œ ì–¸ì–´
            const availableTargets = combinations
                .filter(c => c.native === selectedNative)
                .map(c => c.target);

            if (availableTargets.length === 0) {
                document.getElementById('targetLanguageList').innerHTML = '<p class="text-muted text-center">' + currentUI.notAvailable + '</p>';
                return;
            }

            let targetHtml = '<div class="row g-2">';
            availableTargets.forEach(code => {
                const lang = languages[code];
                targetHtml += `
                    <div class="col-4">
                        <div class="language-select-card text-center" id="target-${code}" onclick="selectTargetLanguage('${code}')">
                            <div class="language-flag">${lang.flag}</div>
                            <div class="language-name">${lang.name}</div>
                        </div>
                    </div>
                `;
            });
            targetHtml += '</div>';
            document.getElementById('targetLanguageList').innerHTML = targetHtml;

            selectedTarget = null;
        }

        function selectTargetLanguage(code) {
            selectedTarget = code;

            document.querySelectorAll('#targetLanguageList .language-select-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById(`target-${code}`).classList.add('selected');

            updateStartButton();
        }

        function updateStartButton() {
            const btn = document.getElementById('startLearningBtn');
            if (selectedNative && selectedTarget) {
                btn.disabled = false;
                const languages = getSupportedLanguages();
                btn.innerHTML = `ğŸš€ ${languages[selectedNative].flag} â†’ ${languages[selectedTarget].flag} ${currentUI.startLearning}`;
            } else {
                btn.disabled = true;
                btn.innerHTML = 'ğŸš€ ' + currentUI.startLearning;
            }
        }

        function startLearning() {
            if (!selectedNative || !selectedTarget) return;

            gameState.nativeLanguage = selectedNative;
            gameState.targetLanguage = selectedTarget;
            currentUI = getUI(selectedNative); // UI ì–¸ì–´ ì—…ë°ì´íŠ¸

            // í”Œë˜ì‹œì¹´ë“œ ìƒíƒœ ì´ˆê¸°í™” (ìƒˆ ì–¸ì–´ ì„ íƒ ì‹œ)
            fcState.completed = false;
            fcState.studiedWords = [];

            saveGameState();

            // ë‹¨ì–´ ë°ì´í„° ë™ì  ë¡œë”© í›„ ë©”ì¸ ë©”ë‰´ë¡œ
            loadWordPack(selectedNative, selectedTarget).then(words => {
                currentWordDatabase = words;
                // UI ì–¸ì–´ ì¬ì„¤ì •
                currentUI = getUI(selectedNative);
                showMainMenu();
            }).catch(err => {
                console.error('Failed to load word pack:', err);
                currentWordDatabase = [];
                currentUI = getUI(selectedNative);
                showMainMenu();
            });
        }

        function showMainMenu() {
            hideAll();
            document.getElementById('mainMenu').classList.remove('hidden');

            const languages = getSupportedLanguages();

            // ì–¸ì–´ ì •ë³´ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
            if (!selectedNative || !languages[selectedNative]) {
                selectedNative = 'en';
            }
            if (!selectedTarget || !languages[selectedTarget]) {
                selectedTarget = 'ko';
            }
            if (!currentUI) {
                currentUI = getUI(selectedNative);
            }

            // í—¤ë” ì—…ë°ì´íŠ¸ - í”Œë˜ê·¸ì™€ ì–¸ì–´ ë°©í–¥
            const nativeFlagEl = document.getElementById('nativeFlagDisplay');
            const targetFlagEl = document.getElementById('targetFlagDisplay');
            const titleEl = document.getElementById('learningTitle');
            const subtitleEl = document.getElementById('letsStudyText');

            if (nativeFlagEl) nativeFlagEl.textContent = languages[selectedNative].flag;
            if (targetFlagEl) targetFlagEl.textContent = languages[selectedTarget].flag;
            if (titleEl) titleEl.textContent = `${languages[selectedNative].name} â†’ ${languages[selectedTarget].name}`;
            if (subtitleEl) subtitleEl.textContent = currentUI.letsStudy;

            updateUILanguage();
            updateUI();
            updateQuizButton();
        }

        function changeLanguage() {
            hideAll();
            document.getElementById('languageSelect').classList.remove('hidden');

            // ì·¨ì†Œ ë²„íŠ¼ í‘œì‹œ (ì´ë¯¸ ì–¸ì–´ê°€ ì„¤ì •ëœ ê²½ìš°)
            const cancelBtn = document.getElementById('cancelLangBtn');
            if (gameState.nativeLanguage && gameState.targetLanguage) {
                cancelBtn.classList.remove('hidden');
                cancelBtn.textContent = 'â† ' + currentUI.home;
            } else {
                cancelBtn.classList.add('hidden');
            }

            // í˜„ì¬ ì„ íƒê°’ ì €ì¥
            const savedNative = selectedNative;
            const savedTarget = selectedTarget;

            renderLanguageSelection();

            // í˜„ì¬ ì„ íƒ ë³µì› (ì‹œê°ì  í‘œì‹œ + ë³€ìˆ˜ ì„¤ì •)
            if (savedNative) {
                selectedNative = savedNative;
                document.getElementById(`native-${savedNative}`)?.classList.add('selected');

                // íƒ€ê²Ÿ ì–¸ì–´ ëª©ë¡ ë Œë”ë§
                const languages = getSupportedLanguages();
                const combinations = getAvailableCombinations();
                const availableTargets = combinations
                    .filter(c => c.native === savedNative)
                    .map(c => c.target);

                let targetHtml = '<div class="row g-2">';
                availableTargets.forEach(code => {
                    const lang = languages[code];
                    targetHtml += `
                        <div class="col-4">
                            <div class="language-select-card text-center" id="target-${code}" onclick="selectTargetLanguage('${code}')">
                                <div class="language-flag">${lang.flag}</div>
                                <div class="language-name">${lang.name}</div>
                            </div>
                        </div>
                    `;
                });
                targetHtml += '</div>';
                document.getElementById('targetLanguageList').innerHTML = targetHtml;

                // íƒ€ê²Ÿ ì„ íƒ ë³µì›
                if (savedTarget) {
                    selectedTarget = savedTarget;
                    document.getElementById(`target-${savedTarget}`)?.classList.add('selected');
                }

                updateStartButton();
            }
        }

        // ===== UI ì—…ë°ì´íŠ¸ =====
        function updateUI() {
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('xp').textContent = gameState.xp;
            document.getElementById('totalScore').textContent = gameState.totalScore;
            document.getElementById('streak').textContent = gameState.streak;
            document.getElementById('todayLearned').textContent = gameState.todayLearned;
            document.getElementById('dailyGoal').textContent = gameState.dailyGoal;

            const xpForLevel = gameState.level * 100;
            const xpProgress = (gameState.xp % xpForLevel) / xpForLevel * 100;
            document.getElementById('xpBar').style.width = xpProgress + '%';
            document.getElementById('xpToNext').textContent = xpForLevel - (gameState.xp % xpForLevel);

            const dailyProgress = Math.min((gameState.todayLearned / gameState.dailyGoal) * 100, 100);
            document.getElementById('dailyProgress').style.width = dailyProgress + '%';
        }

        function addXP(amount) {
            gameState.xp += amount;
            const xpForLevel = gameState.level * 100;
            while (gameState.xp >= xpForLevel * gameState.level) {
                gameState.level++;
                alert(`ğŸ‰ ${currentUI.levelUp} ${gameState.level} ${currentUI.achieved}`);
            }
            updateUI();
            saveGameState();
        }

        // ===== ë„¤ë¹„ê²Œì´ì…˜ =====
        function goHome() {
            hideAll();
            document.getElementById('mainMenu').classList.remove('hidden');
            updateUI();
            updateQuizButton();
        }

        function hideAll() {
            document.getElementById('languageSelect').classList.add('hidden');
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('flashcardMode').classList.add('hidden');
            document.getElementById('flashcardComplete').classList.add('hidden');
            document.getElementById('quizMode').classList.add('hidden');
            document.getElementById('quizResult').classList.add('hidden');
            document.getElementById('progressView').classList.add('hidden');
            document.getElementById('settingsView').classList.add('hidden');
            document.getElementById('helpView').classList.add('hidden');
        }

        // ===== í”Œë˜ì‹œì¹´ë“œ =====
        function startFlashcard() {
            hideAll();
            document.getElementById('flashcardMode').classList.remove('hidden');

            fcState.words = currentWordDatabase.filter(w => gameState.selectedLevels.includes(w.level));
            shuffleArray(fcState.words);
            fcState.words = fcState.words.slice(0, gameState.wordCount);
            fcState.currentIndex = 0;
            fcState.isFlipped = false;
            fcState.studiedWords = [];
            fcState.earnedXP = 0;
            fcState.completed = false;

            updateUILanguage();
            showFlashcard();
        }

        function showFlashcard() {
            const word = fcState.words[fcState.currentIndex];
            document.getElementById('fcWord').textContent = word.word;
            document.getElementById('fcReading').textContent = word.reading || '';
            document.getElementById('fcMeaning').textContent = word.meaning;
            document.getElementById('fcExample').textContent = `"${word.example}"`;
            document.getElementById('fcExampleMeaning').textContent = word.exampleMeaning || '';
            document.getElementById('fcLevel').textContent = `Lv.${word.level}`;
            document.getElementById('fcCategoryBadge').textContent = word.category;
            document.getElementById('fcCurrent').textContent = fcState.currentIndex + 1;
            document.getElementById('fcTotal').textContent = fcState.words.length;

            document.getElementById('cardFront').classList.remove('hidden');
            document.getElementById('cardBack').classList.add('hidden');
            fcState.isFlipped = false;

            const progress = ((fcState.currentIndex + 1) / fcState.words.length) * 100;
            document.getElementById('fcProgress').style.width = progress + '%';
        }

        function flipCard() {
            fcState.isFlipped = !fcState.isFlipped;
            if (fcState.isFlipped) {
                document.getElementById('cardFront').classList.add('hidden');
                document.getElementById('cardBack').classList.remove('hidden');
            } else {
                document.getElementById('cardFront').classList.remove('hidden');
                document.getElementById('cardBack').classList.add('hidden');
            }
        }

        function markKnown() {
            const word = fcState.words[fcState.currentIndex];
            if (!gameState.learnedWords.includes(word.word)) {
                gameState.learnedWords.push(word.word);
            }
            fcState.studiedWords.push(word);
            fcState.earnedXP += 10;

            addXP(10);
            gameState.totalScore += 10;
            gameState.todayLearned++;
            gameState.lastStudyDate = new Date().toDateString();
            if (gameState.todayLearned === 1) gameState.streak++;

            saveGameState();
            nextFlashcard();
        }

        function markUnknown() {
            const word = fcState.words[fcState.currentIndex];
            fcState.studiedWords.push(word);
            nextFlashcard();
        }

        function nextFlashcard() {
            fcState.currentIndex++;
            if (fcState.currentIndex >= fcState.words.length) {
                showFlashcardComplete();
            } else {
                showFlashcard();
            }
        }

        function showFlashcardComplete() {
            hideAll();
            document.getElementById('flashcardComplete').classList.remove('hidden');

            const learnedCount = fcState.studiedWords.filter(w =>
                gameState.learnedWords.includes(w.word)
            ).length;

            document.getElementById('fcLearnedCount').textContent = learnedCount;
            document.getElementById('fcEarnedXP').textContent = fcState.earnedXP;
            document.getElementById('fcStudiedCount').textContent = fcState.studiedWords.length;

            fcState.completed = true;
            updateQuizButton();
            updateUILanguage();
        }

        function startQuizFromFlashcard() {
            hideAll();
            document.getElementById('quizMode').classList.remove('hidden');

            quizState.words = [...fcState.studiedWords];
            shuffleArray(quizState.words);
            quizState.currentIndex = 0;
            quizState.score = 0;
            quizState.answered = false;

            document.getElementById('qTotal').textContent = quizState.words.length;
            updateUILanguage();
            showQuiz();
        }

        function speakWord() {
            const word = fcState.words[fcState.currentIndex];
            const audioFile = getAudioPath(selectedTarget, word.word, 'words');
            speak(word.word, audioFile);
        }

        function speakExample() {
            const word = fcState.words[fcState.currentIndex];
            const audioFile = getAudioPath(selectedTarget, word.word, 'examples');
            speak(word.example, audioFile);
        }

        // ===== í€´ì¦ˆ =====
        function startQuiz() {
            if (!fcState.completed || fcState.studiedWords.length === 0) {
                alert('ğŸ¯ ' + currentUI.quizAlert);
                return;
            }

            hideAll();
            document.getElementById('quizMode').classList.remove('hidden');

            quizState.words = [...fcState.studiedWords];
            shuffleArray(quizState.words);
            quizState.currentIndex = 0;
            quizState.score = 0;
            quizState.answered = false;

            updateUILanguage();
            showQuiz();
        }

        function showQuiz() {
            const word = quizState.words[quizState.currentIndex];
            quizState.currentWord = word;
            quizState.answered = false;

            document.getElementById('quizWord').textContent = word.word;
            document.getElementById('quizReading').textContent = word.reading || '';
            document.getElementById('qCurrent').textContent = quizState.currentIndex + 1;
            document.getElementById('qTotal').textContent = quizState.words.length;
            document.getElementById('qScore').textContent = quizState.score;

            // ì„ íƒì§€ ìƒì„±
            const options = generateOptions(word.meaning);
            let optionsHtml = '';
            options.forEach((opt, i) => {
                optionsHtml += `<div class="quiz-option" onclick="selectAnswer(${i}, '${opt.replace(/'/g, "\\'")}')">${opt}</div>`;
            });
            document.getElementById('quizOptions').innerHTML = optionsHtml;

            document.getElementById('quizFeedback').classList.add('hidden');
            document.getElementById('nextQuizBtn').classList.add('hidden');

            const progress = ((quizState.currentIndex + 1) / quizState.words.length) * 100;
            document.getElementById('qProgress').style.width = progress + '%';
        }

        function generateOptions(correct) {
            const allMeanings = currentWordDatabase.map(w => w.meaning);
            const options = [correct];

            while (options.length < 4) {
                const random = allMeanings[Math.floor(Math.random() * allMeanings.length)];
                if (!options.includes(random)) {
                    options.push(random);
                }
            }

            shuffleArray(options);
            return options;
        }

        function selectAnswer(index, answer) {
            if (quizState.answered) return;
            quizState.answered = true;

            const correct = quizState.currentWord.meaning;
            const options = document.querySelectorAll('.quiz-option');

            options.forEach((opt, i) => {
                opt.classList.add('disabled');
                if (opt.textContent === correct) {
                    opt.classList.add('correct');
                } else if (i === index && answer !== correct) {
                    opt.classList.add('wrong');
                }
            });

            const feedback = document.getElementById('quizFeedback');
            const feedbackText = document.getElementById('feedbackText');
            const feedbackExample = document.getElementById('feedbackExample');

            if (answer === correct) {
                feedback.style.background = '#d4edda';
                feedbackText.textContent = 'ğŸ‰ ' + currentUI.correct;
                quizState.score++;
            } else {
                feedback.style.background = '#f8d7da';
                feedbackText.textContent = `ğŸ˜… ${currentUI.wrongAnswer} "${correct}" ${currentUI.is}`;
            }

            feedbackExample.textContent = `${currentUI.example}: ${quizState.currentWord.example}`;
            feedback.classList.remove('hidden');
            document.getElementById('nextQuizBtn').classList.remove('hidden');

            gameState.totalAnswered++;
            if (answer === correct) gameState.totalCorrect++;
            saveGameState();
        }

        function nextQuiz() {
            quizState.currentIndex++;
            if (quizState.currentIndex >= quizState.words.length) {
                showQuizResult();
            } else {
                showQuiz();
            }
        }

        function showQuizResult() {
            hideAll();
            document.getElementById('quizResult').classList.remove('hidden');

            const total = quizState.words.length;
            const score = quizState.score;
            const percent = Math.round((score / total) * 100);

            document.getElementById('resultScore').textContent = `${score}/${total}`;
            document.getElementById('resultPercent').textContent = percent;

            // ê²°ê³¼ì— ë”°ë¥¸ ì´ëª¨ì§€
            if (percent === 100) {
                document.getElementById('resultEmoji').textContent = 'ğŸ†';
                document.getElementById('resultTitle').textContent = currentUI.perfect;
                gameState.medals.gold++;
            } else if (percent >= 80) {
                document.getElementById('resultEmoji').textContent = 'ğŸ‰';
                document.getElementById('resultTitle').textContent = currentUI.excellent;
                gameState.medals.silver++;
            } else if (percent >= 60) {
                document.getElementById('resultEmoji').textContent = 'ğŸ‘';
                document.getElementById('resultTitle').textContent = currentUI.good;
                gameState.medals.bronze++;
            } else {
                document.getElementById('resultEmoji').textContent = 'ğŸ’ª';
                document.getElementById('resultTitle').textContent = currentUI.tryAgain;
            }

            const earnedXP = score * 10;
            const earnedScore = score * 10;
            document.getElementById('earnedXP').textContent = earnedXP;
            document.getElementById('earnedScore').textContent = earnedScore;

            addXP(earnedXP);
            gameState.totalScore += earnedScore;
            gameState.quizzesCompleted++;
            saveGameState();

            if (percent >= 60 && typeof confetti !== 'undefined') {
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            }

            updateUILanguage();
        }

        function speakQuizWord() {
            const audioFile = getAudioPath(selectedTarget, quizState.currentWord.word, 'words');
            speak(quizState.currentWord.word, audioFile);
        }

        function retryQuiz() {
            hideAll();
            document.getElementById('quizMode').classList.remove('hidden');

            shuffleArray(quizState.words);
            quizState.currentIndex = 0;
            quizState.score = 0;
            quizState.answered = false;

            showQuiz();
        }

        function updateQuizButton() {
            const quizBtn = document.getElementById('quizMenuBtn');
            const quizDesc = document.getElementById('quizMenuDesc');

            if (fcState.completed && fcState.studiedWords.length > 0) {
                quizBtn.style.opacity = '1';
                quizBtn.style.pointerEvents = 'auto';
                quizDesc.textContent = currentUI.quizDesc;
                quizBtn.classList.add('quiz-ready');
            } else {
                quizBtn.style.opacity = '0.6';
                quizDesc.textContent = currentUI.quizLocked;
                quizBtn.classList.remove('quiz-ready');
            }
        }

        // ===== ì§„í–‰ ìƒí™© =====
        function showProgress() {
            hideAll();
            document.getElementById('progressView').classList.remove('hidden');

            const learned = gameState.learnedWords.length;
            const total = currentWordDatabase.length;
            const percent = total > 0 ? Math.round((learned / total) * 100) : 0;

            document.getElementById('learnedWords').textContent = learned;
            document.getElementById('totalProgress').style.width = percent + '%';
            document.getElementById('learnedPercent').textContent = percent;

            document.getElementById('statQuizzes').textContent = gameState.quizzesCompleted;
            const accuracy = gameState.totalAnswered > 0
                ? Math.round((gameState.totalCorrect / gameState.totalAnswered) * 100)
                : 0;
            document.getElementById('statAccuracy').textContent = accuracy;

            document.getElementById('bronzeCount').textContent = gameState.medals.bronze;
            document.getElementById('silverCount').textContent = gameState.medals.silver;
            document.getElementById('goldCount').textContent = gameState.medals.gold;

            updateUILanguage();
        }

        // ===== ì„¤ì • =====
        function showSettings() {
            hideAll();
            document.getElementById('settingsView').classList.remove('hidden');

            // ë ˆë²¨ ì„ íƒ ìƒì„±
            let levelHtml = '';
            for (let i = 1; i <= 5; i++) {
                const checked = gameState.selectedLevels.includes(i) ? 'checked' : '';
                levelHtml += `
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="level${i}" value="${i}" ${checked}>
                        <label class="form-check-label" for="level${i}">Lv.${i}</label>
                    </div>
                `;
            }
            document.getElementById('levelSelect').innerHTML = levelHtml;

            document.getElementById(`goal${gameState.dailyGoal}`).checked = true;
            document.getElementById(`word${gameState.wordCount}`).checked = true;

            updateUILanguage();
        }

        function showHelp() {
            hideAll();
            document.getElementById('helpView').classList.remove('hidden');
            updateUILanguage();
        }

        function saveSettings() {
            gameState.selectedLevels = [];
            for (let i = 1; i <= 5; i++) {
                if (document.getElementById(`level${i}`).checked) {
                    gameState.selectedLevels.push(i);
                }
            }
            if (gameState.selectedLevels.length === 0) {
                gameState.selectedLevels = [1];
            }

            const goalRadio = document.querySelector('input[name="dailyGoal"]:checked');
            gameState.dailyGoal = parseInt(goalRadio.value);

            const wordRadio = document.querySelector('input[name="wordCount"]:checked');
            gameState.wordCount = parseInt(wordRadio.value);

            saveGameState();
            alert(currentUI.settingsSaved);
            goHome();
        }

        function resetProgress() {
            if (confirm(currentUI.confirmReset)) {
                localStorage.removeItem('universalLanguageGame');
                location.reload();
            }
        }

        // ===== ìœ í‹¸ë¦¬í‹° =====
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        let soundEnabled = false;

        function enableSound() {
            soundEnabled = true;
            document.getElementById('soundEnable').classList.add('hidden');
            // íƒ€ê²Ÿ ì–¸ì–´ë¡œ "ì¤€ë¹„ ì™„ë£Œ" ë°œìŒ
            const readyMessages = {
                ko: 'ì¤€ë¹„ ì™„ë£Œ!',
                en: 'Ready!',
                ja: 'æº–å‚™å®Œäº†ï¼',
                zh: 'å‡†å¤‡å¥½äº†ï¼',
                es: 'Â¡Listo!',
                fr: 'PrÃªt!',
                de: 'Bereit!'
            };
            speak(readyMessages[selectedTarget] || 'Ready!');
        }

        function getAudioPath(lang, word, type) {
            if (!audioMapping || !audioMapping[lang] || !audioMapping[lang][word]) return null;
            const filename = audioMapping[lang][word];
            return 'audio/' + encodeURIComponent(lang) + '/' + type + '/' + encodeURIComponent(filename) + '.mp3';
        }

        function speak(text, audioFile) {
            if (!soundEnabled) return;

            // 1ìˆœìœ„: MP3 íŒŒì¼ ì¬ìƒ
            if (audioFile) {
                const audio = new Audio(audioFile);
                audio.play().then(() => {
                    // MP3 ì¬ìƒ ì„±ê³µ
                }).catch(() => {
                    // MP3 ì‹¤íŒ¨ ì‹œ í´ë°±
                    speakFallback(text);
                });
                return;
            }

            speakFallback(text);
        }

        function speakFallback(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                const languages = getSupportedLanguages();
                utterance.lang = languages[selectedTarget]?.ttsCode || 'ja-JP';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        // ì´ˆê¸°í™” ì‹¤í–‰ - DOM ë¡œë“œ ì™„ë£Œ í›„
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
