<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Words - ì˜ì–´ ë‹¨ì–´ í•™ìŠµ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=pxbXEbQF"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        * { font-family: 'Noto Sans KR', sans-serif; }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .main-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .stat-badge {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-right: 8px;
        }

        .stat-badge i {
            margin-right: 5px;
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .game-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .card-header-custom {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .card-body-custom {
            padding: 25px;
        }

        /* ë©”ë‰´ ë²„íŠ¼ */
        .menu-btn {
            background: linear-gradient(145deg, #f8f9ff, #fff);
            border: 2px solid #e9ecef;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }

        .menu-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .menu-btn .icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .menu-btn h4 {
            margin: 0;
            color: #333;
        }

        .menu-btn p {
            margin: 5px 0 0;
            color: #666;
            font-size: 0.85rem;
        }

        /* í”Œë˜ì‹œì¹´ë“œ */
        .flashcard {
            background: linear-gradient(145deg, #f8f9ff, #fff);
            border: 3px solid #667eea;
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .flashcard:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .flashcard .word {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .flashcard .meaning {
            font-size: 1.5rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        .flashcard .example {
            font-size: 1rem;
            color: #666;
            font-style: italic;
        }

        .flashcard .category-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
        }

        .flashcard .level-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #22c55e;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
        }

        /* í€´ì¦ˆ ì˜µì…˜ */
        .quiz-option {
            background: #f8f9ff;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1rem;
        }

        .quiz-option:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .quiz-option.correct {
            background: #dcfce7;
            border-color: #22c55e;
            color: #166534;
        }

        .quiz-option.wrong {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        .quiz-option.disabled {
            pointer-events: none;
        }

        /* ì§„í–‰ ë°” */
        .progress-custom {
            height: 10px;
            border-radius: 10px;
            background: #e9ecef;
        }

        .progress-custom .progress-bar {
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        /* ë²„íŠ¼ */
        .btn-gradient {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
            color: white;
        }

        /* ê²°ê³¼ í™”ë©´ */
        .result-emoji {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .result-score {
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ë ˆë²¨ì—… ëª¨ë‹¬ */
        .level-up-animation {
            animation: levelUp 0.5s ease-out;
        }

        @keyframes levelUp {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* XP ë°” */
        .xp-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }

        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24, #f59e0b);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* ìˆ¨ê¹€ */
        .hidden { display: none !important; }

        /* ë°œìŒ ë²„íŠ¼ */
        .speak-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            margin: 10px 0;
        }

        .speak-btn:hover {
            background: #764ba2;
            transform: scale(1.1);
        }

        /* ìŠ¤íŠ¸ë¦­ */
        .streak-fire {
            color: #f59e0b;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            .main-container {
                padding: 10px;
            }
            .flashcard .word {
                font-size: 2rem;
            }
            .flashcard .meaning {
                font-size: 1.2rem;
            }
            .stat-badge {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- í—¤ë” -->
        <div class="header">
            <div class="d-flex justify-content-between align-items-center flex-wrap">
                <div>
                    <span class="stat-badge"><i class="bi bi-fire streak-fire"></i> <span id="streak">0</span>ì¼</span>
                    <span class="stat-badge"><i class="bi bi-star-fill"></i> Lv.<span id="level">1</span></span>
                    <span class="stat-badge"><i class="bi bi-lightning-fill"></i> <span id="xp">0</span> XP</span>
                </div>
                <div>
                    <span class="stat-badge"><i class="bi bi-trophy-fill"></i> <span id="totalScore">0</span>ì </span>
                </div>
            </div>
            <div class="xp-bar mt-2">
                <div class="xp-bar-fill" id="xpBar" style="width: 0%"></div>
            </div>
            <small class="text-muted d-block text-end mt-1">ë‹¤ìŒ ë ˆë²¨ê¹Œì§€ <span id="xpToNext">100</span> XP</small>
        </div>

        <!-- ë©”ì¸ ë©”ë‰´ -->
        <div id="mainMenu" class="game-card">
            <div class="card-header-custom">
                <h2><i class="bi bi-book"></i> English Words</h2>
                <p class="mb-0">ì¬ë¯¸ìˆê²Œ ì˜ì–´ ë‹¨ì–´ í•™ìŠµí•˜ê¸°!</p>
                <small class="opacity-75">v1.0.5</small>
            </div>
            <div class="card-body-custom">
                <div class="row g-3">
                    <div class="col-6">
                        <div class="menu-btn" onclick="startFlashcard()">
                            <div class="icon">ğŸ“š</div>
                            <h4>í”Œë˜ì‹œì¹´ë“œ</h4>
                            <p>ë‹¨ì–´ ì•”ê¸°í•˜ê¸°</p>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="menu-btn" onclick="startQuiz()">
                            <div class="icon">ğŸ¯</div>
                            <h4>í€´ì¦ˆ</h4>
                            <p>ì‹¤ë ¥ í…ŒìŠ¤íŠ¸</p>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="menu-btn" onclick="showProgress()">
                            <div class="icon">ğŸ“Š</div>
                            <h4>ì§„í–‰ ìƒí™©</h4>
                            <p>í•™ìŠµ í˜„í™© ë³´ê¸°</p>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="menu-btn" onclick="showSettings()">
                            <div class="icon">âš™ï¸</div>
                            <h4>ì„¤ì •</h4>
                            <p>ë ˆë²¨ ì„ íƒ</p>
                        </div>
                    </div>
                </div>

                <!-- ì†Œë¦¬ í™œì„±í™” ë²„íŠ¼ -->
                <div id="soundEnable" class="mt-3 p-3 bg-warning bg-opacity-25 rounded-3 text-center">
                    <button class="btn btn-warning" onclick="enableSound()">
                        <i class="bi bi-volume-up-fill"></i> ì†Œë¦¬ ì¼œê¸° (ë¨¼ì € í´ë¦­!)
                    </button>
                </div>

                <!-- ì˜¤ëŠ˜ì˜ ëª©í‘œ -->
                <div class="mt-4 p-3 bg-light rounded-3">
                    <h6><i class="bi bi-flag-fill text-primary"></i> ì˜¤ëŠ˜ì˜ ëª©í‘œ</h6>
                    <div class="progress progress-custom mb-2">
                        <div class="progress-bar" id="dailyProgress" style="width: 0%"></div>
                    </div>
                    <small class="text-muted"><span id="todayLearned">0</span> / <span id="dailyGoal">20</span> ë‹¨ì–´ í•™ìŠµ</small>
                </div>
            </div>
        </div>

        <!-- í”Œë˜ì‹œì¹´ë“œ ëª¨ë“œ -->
        <div id="flashcardMode" class="game-card hidden">
            <div class="card-header-custom">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="btn btn-light btn-sm" onclick="goHome()"><i class="bi bi-arrow-left"></i> í™ˆ</button>
                    <span><span id="fcCurrent">1</span> / <span id="fcTotal">10</span></span>
                    <span class="badge bg-light text-dark" id="fcCategory">ì¹´í…Œê³ ë¦¬</span>
                </div>
            </div>
            <div class="card-body-custom">
                <div class="flashcard" id="flashcard" onclick="flipCard()">
                    <span class="level-badge" id="fcLevel">Lv.1</span>
                    <span class="category-badge" id="fcCategoryBadge">ë™ë¬¼</span>
                    <div id="cardFront">
                        <div class="word" id="fcWord">apple</div>
                        <button class="speak-btn" onclick="event.stopPropagation(); speakWord()">
                            <i class="bi bi-volume-up-fill"></i>
                        </button>
                        <small class="text-muted">ì¹´ë“œë¥¼ íƒ­í•˜ì—¬ ëœ» ë³´ê¸°</small>
                    </div>
                    <div id="cardBack" class="hidden">
                        <div class="meaning" id="fcMeaning">ì‚¬ê³¼</div>
                        <div class="d-flex justify-content-center gap-2 my-2">
                            <button class="speak-btn" onclick="event.stopPropagation(); speakWord()" title="ë‹¨ì–´ ë°œìŒ">
                                <i class="bi bi-volume-up-fill"></i>
                            </button>
                            <button class="speak-btn" onclick="event.stopPropagation(); speakExample()" title="ì˜ˆë¬¸ ë“£ê¸°" style="background: #22c55e;">
                                <i class="bi bi-chat-quote-fill"></i>
                            </button>
                        </div>
                        <div class="example" id="fcExample">"I eat an apple."</div>
                        <small class="text-muted">ğŸ”Š ë‹¨ì–´ | ğŸ’¬ ì˜ˆë¬¸</small>
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <button class="btn btn-outline-danger" onclick="markUnknown()">
                        <i class="bi bi-x-lg"></i> ëª¨ë¥´ê² ì–´ìš”
                    </button>
                    <button class="btn btn-success" onclick="markKnown()">
                        <i class="bi bi-check-lg"></i> ì•Œê² ì–´ìš”! (+10 XP)
                    </button>
                </div>

                <div class="progress progress-custom mt-3">
                    <div class="progress-bar" id="fcProgress" style="width: 10%"></div>
                </div>
            </div>
        </div>

        <!-- í€´ì¦ˆ ëª¨ë“œ -->
        <div id="quizMode" class="game-card hidden">
            <div class="card-header-custom">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="btn btn-light btn-sm" onclick="goHome()"><i class="bi bi-arrow-left"></i> í™ˆ</button>
                    <span><span id="qCurrent">1</span> / <span id="qTotal">10</span></span>
                    <span class="badge bg-success"><i class="bi bi-check"></i> <span id="qScore">0</span></span>
                </div>
            </div>
            <div class="card-body-custom">
                <div class="text-center mb-4">
                    <button class="speak-btn" onclick="speakQuizWord()">
                        <i class="bi bi-volume-up-fill"></i>
                    </button>
                    <h3 class="mt-2" id="quizWord">apple</h3>
                    <p class="text-muted">ìœ„ ë‹¨ì–´ì˜ ëœ»ì€?</p>
                </div>

                <div id="quizOptions">
                    <!-- ì˜µì…˜ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>

                <div id="quizFeedback" class="hidden mt-3 p-3 rounded-3">
                    <p id="feedbackText" class="mb-2"></p>
                    <small id="feedbackExample" class="text-muted"></small>
                </div>

                <button id="nextQuizBtn" class="btn btn-gradient w-100 mt-3 hidden" onclick="nextQuiz()">
                    ë‹¤ìŒ ë¬¸ì œ <i class="bi bi-arrow-right"></i>
                </button>

                <div class="progress progress-custom mt-3">
                    <div class="progress-bar" id="qProgress" style="width: 10%"></div>
                </div>
            </div>
        </div>

        <!-- í”Œë˜ì‹œì¹´ë“œ ì™„ë£Œ -->
        <div id="flashcardComplete" class="game-card hidden">
            <div class="card-body-custom text-center">
                <div class="result-emoji">ğŸ“š</div>
                <h2>í•™ìŠµ ì™„ë£Œ!</h2>
                <p class="text-muted mb-4">
                    <span id="fcLearnedCount">0</span>ê°œ ë‹¨ì–´ë¥¼ í•™ìŠµí–ˆìŠµë‹ˆë‹¤
                </p>

                <div class="p-3 bg-light rounded-3 mb-4">
                    <div class="d-flex justify-content-around">
                        <div>
                            <h4 class="text-success mb-0">+<span id="fcEarnedXP">0</span></h4>
                            <small class="text-muted">íšë“ XP</small>
                        </div>
                        <div>
                            <h4 class="text-primary mb-0"><span id="fcStudiedCount">20</span>ê°œ</h4>
                            <small class="text-muted">í•™ìŠµ ë‹¨ì–´</small>
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <button class="btn btn-gradient btn-lg" onclick="startQuizFromFlashcard()">
                        <i class="bi bi-lightning-fill"></i> ë°©ê¸ˆ í•™ìŠµí•œ ë‹¨ì–´ë¡œ í€´ì¦ˆ!
                    </button>
                    <button class="btn btn-outline-primary" onclick="goHome()">
                        <i class="bi bi-house"></i> í™ˆìœ¼ë¡œ
                    </button>
                </div>
            </div>
        </div>

        <!-- í€´ì¦ˆ ê²°ê³¼ -->
        <div id="quizResult" class="game-card hidden">
            <div class="card-body-custom text-center">
                <div class="result-emoji" id="resultEmoji">ğŸ‰</div>
                <h2 id="resultTitle">í›Œë¥­í•´ìš”!</h2>
                <div class="result-score" id="resultScore">8/10</div>
                <p class="text-muted mb-4">ì •ë‹µë¥  <span id="resultPercent">80</span>%</p>

                <div class="p-3 bg-light rounded-3 mb-4">
                    <div class="d-flex justify-content-around">
                        <div>
                            <h4 class="text-success mb-0">+<span id="earnedXP">100</span></h4>
                            <small class="text-muted">íšë“ XP</small>
                        </div>
                        <div>
                            <h4 class="text-primary mb-0">+<span id="earnedScore">80</span></h4>
                            <small class="text-muted">íšë“ ì ìˆ˜</small>
                        </div>
                    </div>
                </div>

                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary flex-fill" onclick="goHome()">
                        <i class="bi bi-house"></i> í™ˆìœ¼ë¡œ
                    </button>
                    <button class="btn btn-gradient flex-fill" onclick="startQuiz()">
                        <i class="bi bi-arrow-repeat"></i> ë‹¤ì‹œ ë„ì „
                    </button>
                </div>
            </div>
        </div>

        <!-- ì§„í–‰ ìƒí™© -->
        <div id="progressView" class="game-card hidden">
            <div class="card-header-custom">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="btn btn-light btn-sm" onclick="goHome()"><i class="bi bi-arrow-left"></i> í™ˆ</button>
                    <h5 class="mb-0">í•™ìŠµ ì§„í–‰ ìƒí™©</h5>
                    <span></span>
                </div>
            </div>
            <div class="card-body-custom">
                <div class="mb-4">
                    <h6>ì „ì²´ ì§„í–‰ë¥ </h6>
                    <div class="progress progress-custom" style="height: 20px;">
                        <div class="progress-bar" id="totalProgress" style="width: 0%"></div>
                    </div>
                    <small class="text-muted"><span id="learnedWords">0</span> / 500 ë‹¨ì–´ í•™ìŠµ</small>
                </div>

                <h6>ë ˆë²¨ë³„ ì§„í–‰</h6>
                <div id="levelProgress">
                    <!-- ë ˆë²¨ë³„ ì§„í–‰ë¥ ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>

                <div class="mt-4 p-3 bg-light rounded-3">
                    <h6><i class="bi bi-graph-up text-success"></i> í•™ìŠµ í†µê³„</h6>
                    <div class="row text-center">
                        <div class="col-4">
                            <h4 id="statDays">0</h4>
                            <small class="text-muted">í•™ìŠµì¼</small>
                        </div>
                        <div class="col-4">
                            <h4 id="statQuizzes">0</h4>
                            <small class="text-muted">í€´ì¦ˆ ì™„ë£Œ</small>
                        </div>
                        <div class="col-4">
                            <h4 id="statAccuracy">0%</h4>
                            <small class="text-muted">ì •ë‹µë¥ </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì„¤ì • -->
        <div id="settingsView" class="game-card hidden">
            <div class="card-header-custom">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="btn btn-light btn-sm" onclick="goHome()"><i class="bi bi-arrow-left"></i> í™ˆ</button>
                    <h5 class="mb-0">ì„¤ì •</h5>
                    <span></span>
                </div>
            </div>
            <div class="card-body-custom">
                <h6>í•™ìŠµ ë ˆë²¨ ì„ íƒ</h6>
                <div class="mb-3" id="levelSelect">
                    <!-- ë ˆë²¨ ì„ íƒ ë²„íŠ¼ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>

                <h6 class="mt-4">ì¼ì¼ ëª©í‘œ</h6>
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="dailyGoal" id="goal10" value="10">
                    <label class="btn btn-outline-primary" for="goal10">10ê°œ</label>
                    <input type="radio" class="btn-check" name="dailyGoal" id="goal20" value="20" checked>
                    <label class="btn btn-outline-primary" for="goal20">20ê°œ</label>
                    <input type="radio" class="btn-check" name="dailyGoal" id="goal30" value="30">
                    <label class="btn btn-outline-primary" for="goal30">30ê°œ</label>
                </div>

                <h6 class="mt-4">í€´ì¦ˆ ë¬¸ì œ ìˆ˜</h6>
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="quizCount" id="quiz10" value="10" checked>
                    <label class="btn btn-outline-primary" for="quiz10">10ë¬¸ì œ</label>
                    <input type="radio" class="btn-check" name="quizCount" id="quiz20" value="20">
                    <label class="btn btn-outline-primary" for="quiz20">20ë¬¸ì œ</label>
                    <input type="radio" class="btn-check" name="quizCount" id="quiz30" value="30">
                    <label class="btn btn-outline-primary" for="quiz30">30ë¬¸ì œ</label>
                </div>

                <button class="btn btn-gradient w-100 mt-4" onclick="saveSettings()">
                    <i class="bi bi-check-lg"></i> ì €ì¥
                </button>

                <hr class="my-4">

                <button class="btn btn-outline-danger w-100" onclick="resetProgress()">
                    <i class="bi bi-trash"></i> ì§„í–‰ ìƒí™© ì´ˆê¸°í™”
                </button>
            </div>
        </div>
    </div>

    <script src="words.js"></script>
    <script>
        // ===== ê²Œì„ ìƒíƒœ =====
        let gameState = {
            xp: 0,
            level: 1,
            totalScore: 0,
            streak: 0,
            lastStudyDate: null,
            todayLearned: 0,
            dailyGoal: 20,
            quizCount: 10,
            selectedLevels: [1, 2, 3, 4, 5],
            learnedWords: [],
            quizzesCompleted: 0,
            totalCorrect: 0,
            totalAnswered: 0
        };

        // í”Œë˜ì‹œì¹´ë“œ ìƒíƒœ
        let fcState = {
            words: [],
            currentIndex: 0,
            isFlipped: false,
            studiedWords: [],  // í•™ìŠµí•œ ë‹¨ì–´ë“¤
            earnedXP: 0        // íšë“í•œ XP
        };

        // í€´ì¦ˆ ìƒíƒœ
        let quizState = {
            words: [],
            currentIndex: 0,
            score: 0,
            answered: false,
            currentWord: null
        };

        // ===== ì´ˆê¸°í™” =====
        function init() {
            loadGameState();
            updateUI();
            checkStreak();
        }

        function loadGameState() {
            const saved = localStorage.getItem('englishWordsGame');
            if (saved) {
                gameState = { ...gameState, ...JSON.parse(saved) };
            }
        }

        function saveGameState() {
            localStorage.setItem('englishWordsGame', JSON.stringify(gameState));
        }

        function checkStreak() {
            const today = new Date().toDateString();
            if (gameState.lastStudyDate !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                if (gameState.lastStudyDate === yesterday.toDateString()) {
                    // ì—°ì† í•™ìŠµ ìœ ì§€
                } else if (gameState.lastStudyDate !== null) {
                    gameState.streak = 0; // ìŠ¤íŠ¸ë¦­ ë¦¬ì…‹
                }
                gameState.todayLearned = 0;
            }
        }

        // ===== UI ì—…ë°ì´íŠ¸ =====
        function updateUI() {
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('xp').textContent = gameState.xp;
            document.getElementById('totalScore').textContent = gameState.totalScore;
            document.getElementById('streak').textContent = gameState.streak;
            document.getElementById('todayLearned').textContent = gameState.todayLearned;
            document.getElementById('dailyGoal').textContent = gameState.dailyGoal;

            // XP ë°” ì—…ë°ì´íŠ¸
            const xpForLevel = gameState.level * 100;
            const xpProgress = (gameState.xp % xpForLevel) / xpForLevel * 100;
            document.getElementById('xpBar').style.width = xpProgress + '%';
            document.getElementById('xpToNext').textContent = xpForLevel - (gameState.xp % xpForLevel);

            // ì¼ì¼ ëª©í‘œ ì§„í–‰ë¥ 
            const dailyProgress = Math.min((gameState.todayLearned / gameState.dailyGoal) * 100, 100);
            document.getElementById('dailyProgress').style.width = dailyProgress + '%';
        }

        function addXP(amount) {
            gameState.xp += amount;
            const xpForLevel = gameState.level * 100;

            while (gameState.xp >= xpForLevel * gameState.level) {
                gameState.level++;
                showLevelUp();
            }

            updateUI();
            saveGameState();
        }

        function showLevelUp() {
            alert(`ğŸ‰ ë ˆë²¨ì—…! Level ${gameState.level} ë‹¬ì„±!`);
        }

        // ===== ë„¤ë¹„ê²Œì´ì…˜ =====
        function goHome() {
            hideAll();
            document.getElementById('mainMenu').classList.remove('hidden');
            updateUI();
        }

        function hideAll() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('flashcardMode').classList.add('hidden');
            document.getElementById('flashcardComplete').classList.add('hidden');
            document.getElementById('quizMode').classList.add('hidden');
            document.getElementById('quizResult').classList.add('hidden');
            document.getElementById('progressView').classList.add('hidden');
            document.getElementById('settingsView').classList.add('hidden');
        }

        // ===== í”Œë˜ì‹œì¹´ë“œ =====
        function startFlashcard() {
            hideAll();
            document.getElementById('flashcardMode').classList.remove('hidden');

            // ì„ íƒëœ ë ˆë²¨ì˜ ë‹¨ì–´ í•„í„°ë§
            fcState.words = wordDatabase.filter(w => gameState.selectedLevels.includes(w.level));
            shuffleArray(fcState.words);
            fcState.words = fcState.words.slice(0, 20); // 20ê°œë§Œ
            fcState.currentIndex = 0;
            fcState.isFlipped = false;
            fcState.studiedWords = [];  // í•™ìŠµí•œ ë‹¨ì–´ ì´ˆê¸°í™”
            fcState.earnedXP = 0;       // íšë“ XP ì´ˆê¸°í™”

            showFlashcard();
        }

        function showFlashcard() {
            const word = fcState.words[fcState.currentIndex];
            document.getElementById('fcWord').textContent = word.word;
            document.getElementById('fcMeaning').textContent = word.meaning;
            document.getElementById('fcExample').textContent = `"${word.example}"`;
            document.getElementById('fcLevel').textContent = `Lv.${word.level}`;
            document.getElementById('fcCategoryBadge').textContent = word.category;
            document.getElementById('fcCurrent').textContent = fcState.currentIndex + 1;
            document.getElementById('fcTotal').textContent = fcState.words.length;

            // ì¹´ë“œ ì•ë©´ ë³´ì´ê¸°
            document.getElementById('cardFront').classList.remove('hidden');
            document.getElementById('cardBack').classList.add('hidden');
            fcState.isFlipped = false;

            // ì§„í–‰ë¥ 
            const progress = ((fcState.currentIndex + 1) / fcState.words.length) * 100;
            document.getElementById('fcProgress').style.width = progress + '%';
        }

        function flipCard() {
            fcState.isFlipped = !fcState.isFlipped;
            if (fcState.isFlipped) {
                document.getElementById('cardFront').classList.add('hidden');
                document.getElementById('cardBack').classList.remove('hidden');
            } else {
                document.getElementById('cardFront').classList.remove('hidden');
                document.getElementById('cardBack').classList.add('hidden');
            }
        }

        function markKnown() {
            const word = fcState.words[fcState.currentIndex];
            if (!gameState.learnedWords.includes(word.word)) {
                gameState.learnedWords.push(word.word);
            }
            // í•™ìŠµí•œ ë‹¨ì–´ ì¶”ì 
            fcState.studiedWords.push(word);
            fcState.earnedXP += 10;

            addXP(10);
            gameState.totalScore += 10;
            gameState.todayLearned++;
            gameState.lastStudyDate = new Date().toDateString();
            if (gameState.todayLearned === 1) gameState.streak++;
            saveGameState();
            nextFlashcard();
        }

        function markUnknown() {
            // ëª¨ë¥´ëŠ” ë‹¨ì–´ë„ í€´ì¦ˆ ëŒ€ìƒì— í¬í•¨
            const word = fcState.words[fcState.currentIndex];
            fcState.studiedWords.push(word);
            nextFlashcard();
        }

        function nextFlashcard() {
            fcState.currentIndex++;
            if (fcState.currentIndex >= fcState.words.length) {
                showFlashcardComplete();
            } else {
                showFlashcard();
            }
        }

        function showFlashcardComplete() {
            hideAll();
            document.getElementById('flashcardComplete').classList.remove('hidden');

            const learnedCount = fcState.studiedWords.filter(w =>
                gameState.learnedWords.includes(w.word)
            ).length;

            document.getElementById('fcLearnedCount').textContent = learnedCount;
            document.getElementById('fcEarnedXP').textContent = fcState.earnedXP;
            document.getElementById('fcStudiedCount').textContent = fcState.studiedWords.length;
        }

        function startQuizFromFlashcard() {
            hideAll();
            document.getElementById('quizMode').classList.remove('hidden');

            // ë°©ê¸ˆ í•™ìŠµí•œ ë‹¨ì–´ë¡œ í€´ì¦ˆ!
            quizState.words = [...fcState.studiedWords];
            shuffleArray(quizState.words);
            quizState.currentIndex = 0;
            quizState.score = 0;
            quizState.answered = false;

            document.getElementById('qTotal').textContent = quizState.words.length;
            showQuiz();
        }

        function speakWord() {
            const word = fcState.words[fcState.currentIndex];
            speak(word.word);
        }

        function speakExample() {
            const word = fcState.words[fcState.currentIndex];
            speak(word.example);
        }

        // ===== í€´ì¦ˆ =====
        function startQuiz() {
            hideAll();
            document.getElementById('quizMode').classList.remove('hidden');

            // ì„ íƒëœ ë ˆë²¨ì˜ ë‹¨ì–´ í•„í„°ë§
            quizState.words = wordDatabase.filter(w => gameState.selectedLevels.includes(w.level));
            shuffleArray(quizState.words);
            quizState.words = quizState.words.slice(0, gameState.quizCount);
            quizState.currentIndex = 0;
            quizState.score = 0;
            quizState.answered = false;

            showQuiz();
        }

        function showQuiz() {
            const word = quizState.words[quizState.currentIndex];
            quizState.currentWord = word;
            quizState.answered = false;

            document.getElementById('quizWord').textContent = word.word;
            document.getElementById('qCurrent').textContent = quizState.currentIndex + 1;
            document.getElementById('qTotal').textContent = quizState.words.length;
            document.getElementById('qScore').textContent = quizState.score;

            // ì˜µì…˜ ìƒì„±
            const options = generateOptions(word);
            const optionsHtml = options.map((opt, i) => `
                <div class="quiz-option" onclick="selectAnswer(${i}, '${opt.replace(/'/g, "\\'")}')">${opt}</div>
            `).join('');
            document.getElementById('quizOptions').innerHTML = optionsHtml;

            // í”¼ë“œë°± ìˆ¨ê¸°ê¸°
            document.getElementById('quizFeedback').classList.add('hidden');
            document.getElementById('nextQuizBtn').classList.add('hidden');

            // ì§„í–‰ë¥ 
            const progress = ((quizState.currentIndex + 1) / quizState.words.length) * 100;
            document.getElementById('qProgress').style.width = progress + '%';
        }

        function generateOptions(correctWord) {
            const options = [correctWord.meaning];
            const otherWords = wordDatabase.filter(w => w.meaning !== correctWord.meaning);
            shuffleArray(otherWords);

            for (let i = 0; i < 3 && i < otherWords.length; i++) {
                options.push(otherWords[i].meaning);
            }

            shuffleArray(options);
            return options;
        }

        function selectAnswer(index, selected) {
            if (quizState.answered) return;
            quizState.answered = true;

            const correct = quizState.currentWord.meaning;
            const options = document.querySelectorAll('.quiz-option');

            options.forEach((opt, i) => {
                opt.classList.add('disabled');
                if (opt.textContent === correct) {
                    opt.classList.add('correct');
                } else if (i === index && selected !== correct) {
                    opt.classList.add('wrong');
                }
            });

            const feedback = document.getElementById('quizFeedback');
            const feedbackText = document.getElementById('feedbackText');
            const feedbackExample = document.getElementById('feedbackExample');

            gameState.totalAnswered++;

            if (selected === correct) {
                quizState.score++;
                gameState.totalCorrect++;
                feedback.className = 'mt-3 p-3 rounded-3 bg-success bg-opacity-10';
                feedbackText.innerHTML = '<i class="bi bi-check-circle-fill text-success"></i> ì •ë‹µì…ë‹ˆë‹¤! +20 XP';
                // ì¶•í•˜ íš¨ê³¼!
                celebrate();
            } else {
                feedback.className = 'mt-3 p-3 rounded-3 bg-danger bg-opacity-10';
                feedbackText.innerHTML = `<i class="bi bi-x-circle-fill text-danger"></i> ì˜¤ë‹µ! ì •ë‹µ: ${correct}`;
            }

            feedbackExample.textContent = `ì˜ˆë¬¸: ${quizState.currentWord.example}`;
            feedback.classList.remove('hidden');
            document.getElementById('nextQuizBtn').classList.remove('hidden');

            saveGameState();
        }

        function nextQuiz() {
            quizState.currentIndex++;
            if (quizState.currentIndex >= quizState.words.length) {
                showQuizResult();
            } else {
                showQuiz();
            }
        }

        function showQuizResult() {
            hideAll();
            document.getElementById('quizResult').classList.remove('hidden');

            const total = quizState.words.length;
            const score = quizState.score;
            const percent = Math.round((score / total) * 100);
            const earnedXP = score * 20;
            const earnedScore = score * 10;

            // ê²°ê³¼ì— ë”°ë¥¸ ì´ëª¨ì§€
            let emoji = 'ğŸ˜¢';
            let title = 'ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!';
            if (percent >= 90) { emoji = 'ğŸ†'; title = 'ì™„ë²½í•´ìš”!'; }
            else if (percent >= 70) { emoji = 'ğŸ‰'; title = 'í›Œë¥­í•´ìš”!'; }
            else if (percent >= 50) { emoji = 'ğŸ‘'; title = 'ì˜í–ˆì–´ìš”!'; }

            document.getElementById('resultEmoji').textContent = emoji;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultScore').textContent = `${score}/${total}`;
            document.getElementById('resultPercent').textContent = percent;
            document.getElementById('earnedXP').textContent = earnedXP;
            document.getElementById('earnedScore').textContent = earnedScore;

            // XP ë° ì ìˆ˜ ì¶”ê°€
            addXP(earnedXP);
            gameState.totalScore += earnedScore;
            gameState.quizzesCompleted++;
            gameState.todayLearned += score;
            gameState.lastStudyDate = new Date().toDateString();
            if (gameState.todayLearned <= score) gameState.streak++;

            saveGameState();
        }

        function speakQuizWord() {
            speak(quizState.currentWord.word);
        }

        // ===== ì§„í–‰ ìƒí™© =====
        function showProgress() {
            hideAll();
            document.getElementById('progressView').classList.remove('hidden');

            const learned = gameState.learnedWords.length;
            const total = 500;
            const percent = Math.round((learned / total) * 100);

            document.getElementById('learnedWords').textContent = learned;
            document.getElementById('totalProgress').style.width = percent + '%';

            // ë ˆë²¨ë³„ ì§„í–‰ë¥ 
            let levelHtml = '';
            for (let i = 1; i <= 5; i++) {
                const levelWords = wordDatabase.filter(w => w.level === i);
                const learnedInLevel = levelWords.filter(w => gameState.learnedWords.includes(w.word)).length;
                const levelPercent = Math.round((learnedInLevel / levelWords.length) * 100);

                levelHtml += `
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <small>ë ˆë²¨ ${i}: ${levelStats[i].name}</small>
                            <small>${learnedInLevel}/${levelWords.length}</small>
                        </div>
                        <div class="progress progress-custom" style="height: 8px;">
                            <div class="progress-bar" style="width: ${levelPercent}%"></div>
                        </div>
                    </div>
                `;
            }
            document.getElementById('levelProgress').innerHTML = levelHtml;

            // í†µê³„
            document.getElementById('statDays').textContent = gameState.streak;
            document.getElementById('statQuizzes').textContent = gameState.quizzesCompleted;
            const accuracy = gameState.totalAnswered > 0
                ? Math.round((gameState.totalCorrect / gameState.totalAnswered) * 100)
                : 0;
            document.getElementById('statAccuracy').textContent = accuracy + '%';
        }

        // ===== ì„¤ì • =====
        function showSettings() {
            hideAll();
            document.getElementById('settingsView').classList.remove('hidden');

            // ë ˆë²¨ ì„ íƒ ë²„íŠ¼ ìƒì„±
            let levelHtml = '';
            for (let i = 1; i <= 5; i++) {
                const checked = gameState.selectedLevels.includes(i) ? 'checked' : '';
                levelHtml += `
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="level${i}" value="${i}" ${checked}>
                        <label class="form-check-label" for="level${i}">Lv.${i} ${levelStats[i].name}</label>
                    </div>
                `;
            }
            document.getElementById('levelSelect').innerHTML = levelHtml;

            // ì¼ì¼ ëª©í‘œ
            document.getElementById(`goal${gameState.dailyGoal}`).checked = true;

            // í€´ì¦ˆ ë¬¸ì œ ìˆ˜
            document.getElementById(`quiz${gameState.quizCount}`).checked = true;
        }

        function saveSettings() {
            // ë ˆë²¨ ì„ íƒ ì €ì¥
            gameState.selectedLevels = [];
            for (let i = 1; i <= 5; i++) {
                if (document.getElementById(`level${i}`).checked) {
                    gameState.selectedLevels.push(i);
                }
            }
            if (gameState.selectedLevels.length === 0) {
                gameState.selectedLevels = [1];
            }

            // ì¼ì¼ ëª©í‘œ
            const goalRadio = document.querySelector('input[name="dailyGoal"]:checked');
            gameState.dailyGoal = parseInt(goalRadio.value);

            // í€´ì¦ˆ ë¬¸ì œ ìˆ˜
            const quizRadio = document.querySelector('input[name="quizCount"]:checked');
            gameState.quizCount = parseInt(quizRadio.value);

            saveGameState();
            alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            goHome();
        }

        function resetProgress() {
            if (confirm('ì •ë§ ëª¨ë“  ì§„í–‰ ìƒí™©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('englishWordsGame');
                location.reload();
            }
        }

        // ===== ìœ í‹¸ë¦¬í‹° =====
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        let soundEnabled = false;
        let audioContext = null;

        // ì¶•í•˜ íš¨ê³¼
        function celebrate() {
            // íŒ¡íŒŒë ˆ í™”ë©´ (ì»¨í˜í‹°)
            if (typeof confetti !== 'undefined') {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#667eea', '#764ba2', '#f59e0b', '#22c55e', '#ef4444']
                });
            }

            // ì¶•í•˜ ë©œë¡œë””
            playFanfare();
        }

        function playFanfare() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
            const duration = 0.15;

            notes.forEach((freq, i) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = freq;
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime + i * duration);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * duration + duration);

                oscillator.start(audioContext.currentTime + i * duration);
                oscillator.stop(audioContext.currentTime + i * duration + duration);
            });
        }

        function enableSound() {
            // ëª¨ë°”ì¼ì—ì„œ ì˜¤ë””ì˜¤ í™œì„±í™”
            soundEnabled = true;

            // ResponsiveVoice í™œì„±í™”
            if (typeof responsiveVoice !== 'undefined') {
                responsiveVoice.speak("Sound enabled", "US English Female", {
                    volume: 1,
                    onend: function() {
                        document.getElementById('soundEnable').innerHTML =
                            '<span class="text-success"><i class="bi bi-check-circle-fill"></i> ì†Œë¦¬ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!</span>';
                    }
                });
            } else {
                // Web Speech API í™œì„±í™”
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance("Sound enabled");
                    utterance.lang = 'en-US';
                    utterance.onend = function() {
                        document.getElementById('soundEnable').innerHTML =
                            '<span class="text-success"><i class="bi bi-check-circle-fill"></i> ì†Œë¦¬ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!</span>';
                    };
                    speechSynthesis.speak(utterance);
                }
            }
        }

        function speak(text) {
            if (!soundEnabled) {
                alert('ë¨¼ì € ë©”ì¸ í™”ë©´ì—ì„œ "ì†Œë¦¬ ì¼œê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!');
                return;
            }

            // ResponsiveVoice ì‚¬ìš© (ëª¨ë°”ì¼ í˜¸í™˜)
            if (typeof responsiveVoice !== 'undefined') {
                responsiveVoice.cancel();
                responsiveVoice.speak(text, "US English Female", {
                    pitch: 1,
                    rate: 0.9,
                    volume: 1
                });
            } else {
                // í´ë°±: Web Speech API
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.8;
                    speechSynthesis.speak(utterance);
                }
            }
        }

        // ì´ˆê¸°í™” ì‹¤í–‰
        init();
    </script>
</body>
</html>
